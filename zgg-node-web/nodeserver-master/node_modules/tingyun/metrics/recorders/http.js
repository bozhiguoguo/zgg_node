'use strict';

var logger = require('../../util/logger').child('metrics.recorders.http');

function recordWeb(segment, scope) {
    // in web metrics, scope is required
    if (!scope) {
        return;
    }
    var duration = segment.getDurationInMillis();
    var exclusive = segment.getExclusiveDurationInMillis();
    var action = segment.trace.action;
    var partial = segment.partialName;
    var config = segment.trace.action.agent.config;
    var actionApdex = config.web_actions_apdex[scope];

    var agent;
    try {
        agent = segment.trace.action.agent;
    } catch (e) {}

    if (agent && agent.config && agent.config.quantile) {
        logger.debug('action %s duration is: %s', scope, duration);
        agent.quantile.add(scope, duration);
    }

    //action.measure(scope, scope, duration, exclusive);
    action.measureAction(scope, null, duration, exclusive);
    action.setApdex('Apdex/' + partial, duration, actionApdex);
}

module.exports = recordWeb;