<link rel="stylesheet" href="/css/confimProduct.css">
<link rel="stylesheet" href="/css/personal_center.css" >
<style>
    /*.demandDialog{
        overflow: hidden;
        overflow-y: scroll;
    }*/

     .layui-layer-content{
        overflow-y: scroll;
         box-sizing: border-box;
    }

    .layui-layer{
        top: 16%!important;
    }
</style>
{{> head}}
<div class="layui-tab layui-tab-card personCenter_all" id="personCenter_all" >




    <div class="personCenter_nav">
        <ul class="layui-tab-title">
            <li v-bind:class="{'layui-this':pType==''}" @click="pType='';currentPage=1;keywords='';getPagesData();checkAll=false">全部订单</li>
            <li v-bind:class="{'layui-this':pType===0}" @click="pType=0;currentPage=1;keywords='';getPagesData();checkAll=false">待付款</li>
            <li v-bind:class="{'layui-this':pType==1}" @click="pType=1;currentPage=1;keywords='';getPagesData();checkAll=false">已付款</li>
            <li v-bind:class="{'layui-this':pType==-1}" @click="pType=-1;currentPage=1;keywords='';getRefundPagesData();checkAll=false">已退款</li>
        </ul>
        <div class="f_r personCenter_search">
            <select v-model="keyType">
                <option value="3">商标名称</option>
                <option value="1">合同号</option>
                <option value="2">订单号</option>
            </select>
            <button @click="currentPage=1;isClickLastPage=true;searchData()">
                <img src="../img/icon-myorder-search.png" alt=""></button>
            <input id="placeholderText" type="text" placeholder="商标名称" v-model="keywords" @keyup.enter="currentPage=1;searchData()" >
        </div>
    </div>
    <div class="c_b"></div>
    <div class="layui-tab-content-4">
        <div class="layui-tab-item layui-show personCenter_details">
            <div class="personCenter_checkAll">
                <span class="center1" id="LAY_demo">
                    <a class="cartCheckAll" :class="{cartCheckTrue:checkAll}" @click="setCheckAll()"></a>全选
                    <button class="layui-btn" @click="entrust()" style="padding:0 12px;" :class="{buttonColorec9c19:checkItems.length>0}" :disabled="checkItems.length==0 || pType==-1">委托订单</button>
                </span>
                <span class="center2">订单详情</span>
                <span class="center3">公司主体</span>
                <span class="center4">联系人</span>
                <span class="center5">总计</span>
                <span class="center6">订单状态</span>
                <span class="center7" v-html="pType==-1?'合同号':'操作'"></span>
            </div>
            <div class="c_b"></div>
            <div class="personCenter_codity" v-for="item in convertUserOrderList" v-if="pType!=-1" >
                <div class="personCenter_contract" >
                    <p><span>合同号：</span><span v-html="item.contractCode"></span><span v-html="item.zgOrderMainDetailList[0].payTime"></span></p>
                    <!--<div class="personCenter_more" @click="handleHoverItem($event,item,0)">-->
                    <div class="personCenter_more"  @mouseenter.stop="handleHoverItem($event,item,0)" @mousemove="handleHoverItem($event,item,2)" @mouseleave.stop="handleHoverItem($event,item,1)" v-show="!!item.ContracStatus || !!item.zgOrderMainDetailList[0].payStatus">
                        <span class="menu"><!--<img src="../img/icon-myorder-more.png" style="margin: 0;"/>-->更多<img src="../img/icon-payment-dropdown.png"/></span>
                        <div class="personal_order">
                            <!--<div v-if="item.isloading">loading....</div>-->
                            <div v-if="!item.isloading">
                                <!--合同确认-->
                                <!--<span v-if="item.zgOrderMainDetailList[0].payStatus != 0 && item.zgOrderMainDetailList[0].payStatus != 2 && !item.isShow">
                                    <dl @click.stop="contractFile(item)" v-if="item.ContracStatus == 2 && item.zgOrderMainDetailList[0].ptype !='x-'">
                                        <dt><img src="../img/icon_myorder_contractconfirm.png" style="margin-left:0px;"></dt>
                                        <dd id="LAY_sure" style="margin:-20px 0 0 20px;"><a class="sure" data-method="notice">合同确认</a></dd>
                                    </dl>
                                </span>-->
                                <span v-if="item.zgOrderMainDetailList[0].payStatus == 0 && item.ContracStatus == 2">
                                    <dl @click.stop="contractFile(item)">
                                        <dt><img src="../img/icon_myorder_contractconfirm.png" style="margin-left:0px;"></dt>
                                        <dd id="LAY_sure" style="margin:-20px 0 0 20px;"><a class="sure" data-method="notice">合同确认</a></dd>
                                    </dl>
                                </span>
                                <!--索要发票信息-->
                                <dl  v-if=" item,item.isShow">
                                    <dt><img src="../img/icon_myorder_invoice@2x.png"></dt>
                                    <dd  @click="demandInvoice(item.zgOrderMainDetailList[0].orderId,item.zgOrderMainDetailList[0].contractCode,item)">
                                        <a class="sure" data-method="notice"  v-html="demandInvoiceText"></a>
                                    </dd>
                                </dl>


                                <div class="c_b"></div>
                                <dl @click.stop="downFile(item)" v-if="item.ContracStatus == 1">
                                    <dt><img src="../img/icon_myorder_contractconfirm.png"></dt>
                                    <dd id="LAY_down"><a class="sure" data-method="notice">合同下载</a></dd>
                                </dl>
                                <div class="c_b"></div>
                                <dl v-if="item.zgOrderMainDetailList[0].payStatus==0">
                                    <dt><img src="../img/icon_myorder_contractdelete.png"></dt>
                                    <dd id="LAY_delete" class="personal_check"><a class="delete" @click="deleteContract(item)">删除合同</a></dd>
                                </dl>
                                <div class="c_b"></div>
                                <dl v-if="item.ContracStatus == 1">
                                    <dt><img src="../img/icon_myorder_contractunlock.png"></dt>
                                    <dd id="LAY_unlock"><a @click="cancelContract(item)" class="unlock" >解锁合同</a></dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                    <div class="personCenter_pay buttonColor" v-if="item.zgOrderMainDetailList[0].payStatus==0">
                        <!--<a :href="'/order/repayment/'+item.contractCode+'/'+item.zgOrderMainDetailList[0].orderId">立即付款</a>-->
                        <a @click="goPlay(item.contractCode,item.zgOrderMainDetailList[0].orderId)">立即付款</a>
                    </div>
                    <!--<div class="personCenter_pay buttonColor" v-if="(item.zgOrderMainDetailList[0].payStatus==1 || item.zgOrderMainDetailList[0].payStatus==-1) && item.contractStatus != 1">
                        <a @click.stop="contractFile(item)">合同确认</a>
                    </div>-->
                    <div class="personCenter_pay buttonColor" v-if="((item.isDownLine && item.zgOrderMainDetailList[0].ptype =='x-') || (item.zgOrderMainDetailList[0].ptype !='x-' && item.zgOrderMainDetailList[0].payStatus != 0)) && item.contractStatus != 1">
                        <a @click.stop="contractFile(item)">合同确认</a>
                    </div>
                </div>
                <div class="personal_table">
                    <ul v-for="childer in item.zgOrderMainDetailList">
                        <li class="table1" :class="{isentrust:childer.isentrust==1}">
                            <span class="center1">
                                <span v-if="childer.payStatus==0 || childer.payStatus==2 || !childer.canEntrust" style="width: 20px; height: 20px;float: left;margin:0;cursor:auto;"></span>
                                <a v-if="childer.payStatus==1 && childer.canEntrust">
                                    <span v-if='(childer.isentrust==1) ||
                                ((childer.pcode.indexOf("tr_refr") > -1) ||
                                    (childer.pcode == "tr_reg_11") || (childer.pcode.startsWith("cr") || childer.pcode.startsWith("pt_ow")))'
                                        style="width: 20px; height: 20px;float: left;margin:0"></span>
                                     <span v-else
                                           style="margin:0;" class="cartCheckAll" :class="{cartCheckTrue:childer.ischeck}" @click="setItemCheck(childer)">
                                    </span>
                                </a>
                                <!--<a v-if='childer.payStatus==1'>
                                    <span v-if="(childer.isentrust != 1) && (childer.pcode == 'tr_reg_13' || childer.pcode == 'tr_reg_8' || childer.pcode == 'tr_reg_12' || childer.pcode == 'pt_inv_n_2' || childer.pcode == 'pt_inv_urg' || childer.pcode == 'pt_inv_b' || childer.pcode == 'pt_um_n_1' || childer.pcode == 'pt_um_urg' || childer.pcode == 'pt_um_b')"
                                          style="margin:0;" class="cartCheckAll" :class="{cartCheckTrue:childer.ischeck}" @click="setItemCheck(childer)">
                                    </span>
                                </a>-->
                                    <!--<span v-if='childer.isentrust != 1 && (!(childer.pcode.indexOf("tr_refr") > -1) ||
                                    !(childer.pcode == "tr_reg_11") || !(childer.pcode.startsWith("cr") || childer.pcode.startsWith("pt_ow")))'
                                          style="margin:0;" class="cartCheckAll" :class="{cartCheckTrue:childer.ischeck}" @click="setItemCheck(childer)">
                                    </span>-->
                              <!-- <a v-if='childer.payStatus==1'> </a>-->订单号：
                                <b class="zgg_title_orderId" v-html="childer.orderCode" style="width:180px;" :title="childer.orderCode"></b>
                                <b class="zgg_zy" v-if="!childer.serviceName" style="width:70px;">知果果自营</b>
                                <b class="zgg_zy" v-if="childer.serviceName" v-html="childer.serviceName+childer.companyName==0">知果果自营</b>
                            </span>
                            <dl>
                                <dt><img :src="!!childer.picsSmall?ImgUrl+childer.picsSmall:'/img/empty-no-image.png'" width="63" height="63"/></dt>
                                <dd>
                                    <p class="personal_zi" v-html="childer.pname"></p>
                                    <p class="personal_zi" v-html="childer.pdetail||'暂未填写业务名称'"></p>
                                  <!--  <p>小项数量：10 </p>
                                    <p>赔付服务：6个月保险</p>-->
                                </dd>
                            </dl>
                        </li>
                        <li class="table2"><span>${childer.bodyName}</span></li>
                        <li class="table4">
                            <span v-html="childer.personName"></span>
                            <span  v-html="childer.personTel"></span>
                        </li>
                        <li class="table4">
                            <span class="personal_color" v-html="'￥'+childer.money"></span>
                            <!--<span v-if="childer.bankName!='NULL'" v-html="childer.bankName"></span>-->
                        </li>
                        <li class="table5" v-show="childer.payStatus">
                            <span v-if="childer.payStatus==0">未付款</span>
                            <span v-if="childer.payStatus==1">已支付</span>
                            <span v-if="childer.payStatus==-1">退款</span>
                            <span v-if="childer.payStatus==2">受理中</span>
                        </li>
                        <li class="table6" :class="{spcButton:childer.bType !=1 && childer.bType !=''}">
                            <!--<a  v-if="childer.payStatus==1 && childer.ptype !='x-'" class="buttonColorec9c19" target="_blank"
                                v-bind:href="'/business/'+childer.ptype+'/'+childer.orderId+'/'+childer.flowType">业务办理</a>-->
                            <a  v-if="childer.payStatus==1 && childer.ptype !='x-' && childer.ptype != 'la'" class="buttonColorec9c19" id="url"
                                @click="judgeCookies(childer.ptype,childer.orderId,childer.flowType)">业务办理</a>
                            <a v-if="childer.bType == 6 || childer.bType == 11 || childer.bType == 12 " class="buttonColorec9c19" target="_blank" @click="couchDBStore(childer)">查看变更</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="personCenter_codity" v-if="pType==-1">
                <div class="personal_table">
                    <ul v-for="childer in UserOrderRefundList">
                        <li class="table1" :class="{isentrust:childer.isentrust==1}">
                            <span class="center1"><a class="cartCheckAll"  :class="{cartCheckTrue:childer.ischeck}" @click="setItemCheck(childer)"></a>订单号：
                                <b v-html="childer.orderCode" style="width:180px;"></b>
                                <b class="zgg_zy" v-if="!childer.serviceName" style="width:70px;">知果果自营</b>
                                <b class="zgg_zy" v-if="childer.serviceName" v-html="childer.serviceName+childer.companyName==0">知果果自营</b>
                            </span>
                            <dl>
                                <dt><img :src="!!childer.picsSmall?ImgUrl+childer.picsSmall:'/img/empty-no-image.png'" width="63" height="63"/></dt>
                                <dd>
                                    <p class="personal_zi" v-html="childer.pname"></p>
                                    <p class="personal_zi" v-html="childer.pdetail||'暂未填写业务名称'"></p>
                                    <!--  <p>小项数量：10</p>
                                      <p>赔付服务：6个月保险</p>-->
                                </dd>
                            </dl>
                        </li>
                        <li class="table2" style="word-wrap:break-word;overflow:hidden;" v-html="childer.bodyName"></li>
                        <li class="table4">
                            <span v-html="childer.personName"></span>
                            <span  v-html="childer.personTel"></span>
                        </li>
                        <li class="table4">
                            <span class="personal_color" v-html="'￥'+childer.money"></span>
                            <span v-if="childer.bankName!='NULL'" v-html="childer.bankName"></span>
                        </li>
                        <li class="table5" v-show="childer.payStatus">
                            <span v-if="childer.payStatus==-1">退款</span>
                        </li>
                        <li class="table4 table6">
                            <span v-html="childer.contractCode"></span>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="demo4" class="page userPage" v-show='pType!=-1'></div>
            <div id="demo5" class="page userPage" v-show='pType==-1'></div>
            <!--暂无收件信息-->
            <div class="basicNoinfo" v-if="convertUserOrderList.length==0 && pType!=-1">
                <dl>
                    <dt><img src="/img/icon-emptystate.png" /></dt>
                    <dd>暂无此状态订单<a href="javaScript:;" @click="pType='';getPagesData()"><span>查看全部状态</span></a></dd>
                </dl>
            </div>
            <div class="basicNoinfo" v-if="UserOrderRefundList.length==0 && pType==-1">
                <dl>
                    <dt><img src="/img/icon-emptystate.png" /></dt>
                    <dd>暂无此状态订单<a href="javaScript:;" @click="pType='';getPagesData()"><span>查看全部状态</span></a></dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="changelog hide" id="changelog">
        <ul>
            <li v-for="item in modifyInfo">
                <span>原订单金额：<label v-html="item.oldMoney"></label></span>
                <span>修改后金额：<label v-html="item.money"></label></span>
                <span>创建时间：<label v-html="item.createTime"></label></span>
                <span v-if="payStatus == 1">支付时间：<label v-html="item.paytime"></label></span>
            </li>
            <li v-if="modifyInfo.length <=0">暂未查询到变更信息，请检查操作</li>
        </ul>
    </div>


    <!--索要发票信息-->
    <div class="demandInvoice" id="dialog" style="display: none">
        <!--普票   专票-->
        <div class="confim_invoceInfo" >
            <div class="confim_divTtpe" style="float: none">发票类型：</div>
            <ul class="confim_invoceLi" style="margin-top:8px;">
                <!--默认显示普票或者专票-->
                <li class="layui-btn layui-btn-primary" @click="invoiceData.billType=1" id="billType1">增值税普通发票</li>
                <li class="layui-btn layui-btn-primary" @click="invoiceData.billType=2" id="billType2">增值税专用发票</li>
            </ul>
            <div style="clear: both"></div>
            <div class="border_bottom"></div>
            <!--查看信息是否正确    不编辑状体   加判断是否转票-->
            <div class="compile" v-if="isCompile">
                <table>
                    <tr>
                        <td>发票抬头：</td>
                        <td class="Invoice_table_td" :title="invoiceData.unitName">${invoiceData.unitName}</td>
                    </tr>
                    <tr>
                        <td>纳税人识别号：</td>
                        <td class="Invoice_table_td" :title="invoiceData.taxpayerNo">${invoiceData.taxpayerNo}</td>
                    </tr>
                    <tr v-show="invoiceData.billType == 2">
                        <td>注册地址：</td>
                        <td class="Invoice_table_td" :title="invoiceData.registerAddress">${invoiceData.registerAddress}</td>
                    </tr>
                    <tr v-show="invoiceData.billType == 2">
                        <td>注册电话：</td>
                        <td class="Invoice_table_td" :title="invoiceData.registerPhone">${invoiceData.registerPhone}</td>
                    </tr>
                    <tr v-show="invoiceData.billType == 2">
                        <td>开户银行：</td>
                        <td class="Invoice_table_td" :title="invoiceData.openBank">${invoiceData.openBank}</td>
                    </tr>
                    <tr v-show="invoiceData.billType == 2">
                        <td>银行账号：</td>
                        <td class="Invoice_table_td" :title="invoiceData.bankAcount">${invoiceData.bankAcount}</td>
                    </tr>
                    <tr v-show="invoiceData.billType == 2" style="position: relative">
                        <td style="position:absolute;left: 26px;">一般纳税人证明：</td>
                        <td>
                            <div class="upload_add_file"  v-if="addTaxpayerPath"  style="border: none;margin-left: 15px;">
                                <div class="pictureShow">
                                    <img id="deleteImg" class="picture" :src="addTaxpayerPath"  alt="" style="width:100px;height:100px;display: inline-block">
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <!--专票可编辑状态    使用V-show 判断是编辑还是查看状态-->
            <form v-show="!isCompile && invoiceData.billType == 2"   class="layui-form"  data-vv-scope="form-invoic-add">
                <table class="confim_box" style="width:420px;"><tr><td class="confim_boxNum"><span>*</span>发票抬头：</td></tr>
                    <tr><td><input type="text" class="input" name="unitName" v-validate="'required'" data-vv-as="发票抬头" v-model="invoiceData.unitName"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.unitName') }"/>
                        <p class="help is-danger" v-show="errors.has('form-invoic-add.unitName')">${errors.first('form-invoic-add.unitName')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>纳税人识别号：</td></tr>
                    <tr><td><input type="text" class="input" v-model="invoiceData.taxpayerNo" name="taxpayerNo" v-validate="'required|taxpayerNo'" data-vv-as="纳税人识别号"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.taxpayerNo') }"/>
                        <p  class="help is-danger" v-show="errors.has('form-invoic-add.taxpayerNo')">${errors.first('form-invoic-add.taxpayerNo')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>注册地址：</td></tr>
                    <tr><td><input type="text" class="input" v-model="invoiceData.registerAddress" name="registerAddress" v-validate="'required'" data-vv-as="注册地址"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.registerAddress') }"/>
                        <p class="help is-danger"v-show="errors.has('form-invoic-add.registerAddress')">${errors.first('form-invoic-add.registerAddress')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>注册电话：</td></tr>
                    <tr><td><input type="text" class="input" v-model="invoiceData.registerPhone"  name="registerPhone" v-validate="'required|tel'" data-vv-as="注册电话"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.registerPhone') }"/>
                        <p class="help is-danger"  v-show="errors.has('form-invoic-add.registerPhone')">${errors.first('form-invoic-add.registerPhone')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>开户银行：</td></tr>
                    <tr><td><input type="text" class="input"  v-model="invoiceData.openBank" name="openUserBank" v-validate="'required'" data-vv-as="开户银行"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.openUserBank') }"/><p class="help is-danger" v-show="errors.has('form-invoic-add.openUserBank')">${errors.first('form-invoic-add.openUserBank')}</p></td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>银行账号：</td></tr>
                    <tr><td><input type="text" class="input" v-model="invoiceData.bankAcount" name="bankUserAcount" v-validate="'required|num'" data-vv-as="银行账号"
                                   :class="{'input': true, 'is-danger': errors.has('form-invoic-add.bankUserAcount') }"/>
                        <p class="help is-danger" v-show="errors.has('form-invoic-add.bankUserAcount')">${errors.first('form-invoic-add.bankUserAcount')}</p></td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>一般纳税人证明：</td></tr>
                    <tr style="position: relative;">
                        <td style="margin-bottom: 15px; position:relative">
                            <div class="upload_add_file" style="border: none;">
                                <div id="item_addInfo" class="f_l" v-show="!addTaxpayerPath" style='width:100px;height:100px; border: 1px dashed #979797;'>
                                    <a data-method="notice"  id="addInfo"></a>
                                    <!--<img src="\img\icon_upload_plus.png" alt="" style="width: 24px;height:24px;margin-left:37px; margin-top: -134px;">-->
                                </div>
                                <input type="hidden" class="hide" name="addTaxpayerPath" v-model="addTaxpayerPath" data-vv-as="文件" class="inputW"
                                       v-validate="'required'" :class="{'input': true, 'is-danger': errors.has('form-invoic-add.addTaxpayerPath') }" >
                                <div class="pictureShow" v-show="addTaxpayerPath">
                                    <img class="picture" :src="addTaxpayerPath"  alt="" style="width:102px;height:102px;display: inline-block">
                                    <img src="\img\icon_upload_delete.png" class="icon_delete" @click="addTaxpayerPath = ''">
                                </div>
                            </div>

                            <p class="red clear-both" style="position: absolute" v-show="errors.has('form-invoic-add.addTaxpayerPath')">${errors.first('form-invoic-add.addTaxpayerPath')}</p>
                            <p style="position: absolute;left: 111px;bottom: 77px;font-size:12px;line-height: 2;width: 340px">一般纳税人证明可以企业对应省国税局网站查询截取如：<a target="_blank" href="/cooperation/addedIRS" style="color:rgb(35, 132, 204);display: block">${host}/cooperation/addedIRS</a></p>
                            <p style="margin-top:-20px;margin-left: 110px;">请上传一般纳税人证明</p>
                        </td>
                    </tr>
                </table>
            </form>
            <!--普票可编辑状态-->
            <form v-show="!isCompile && invoiceData.billType == 1"   class="layui-form"  data-vv-scope="form-invoic11-add">
                <table class="confim_box" ><tr><td class="confim_boxNum"><span>*</span>发票抬头：</td></tr>
                    <tr><td>
                        <input type="text" class="input" name="username" v-validate="'required'" data-vv-as="发票抬头"  v-model="invoiceData.unitName"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic11-add.username') }"/>
                        <p class="help is-danger" v-show="errors.has('form-invoic11-add.username')">${errors.first('form-invoic11-add.username')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span>*</span>纳税人识别号：</td></tr>
                    <tr><td>
                        <input type="text" class="input" v-model="invoiceData.taxpayerNo" name="taxpayerNo" v-validate="'required|taxpayerNo'" data-vv-as="纳税人识别号"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic11-add.taxpayerNo') }"/>
                        <p  class="help is-danger" v-show="errors.has('form-invoic11-add.taxpayerNo')">${errors.first('form-invoic11-add.taxpayerNo')}</p>
                    </td></tr>
                    <!--<tr><td class="confim_boxNum"><span></span>注册地址：</td></tr>
                    <tr><td>
                        <input type="text" class="input" v-model="invoiceData.registerAddress" />
                    </td></tr>
                    <tr><td class="confim_boxNum"><span></span>注册电话：</td></tr>
                    <tr><td>
                        <input type="text" class="input" name="registerPhone" v-model="invoiceData.registerPhone" v-validate="'tel'" data-vv-as="注册电话"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic11-add.registerPhone') }"/>
                        <p class="help is-danger" v-show="errors.has('form-invoic11-add.registerPhone')">${errors.first('form-invoic11-add.registerPhone')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span></span>开户银行：</td></tr>
                    <tr><td>
                        <input type="text" class="input"  v-model="invoiceData.openBank"/>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span></span>银行账号：</td></tr>
                    <tr><td>
                        <input type="text" class="input" v-model="invoiceData.bankAcount" name="bankUserAcount" v-validate="'num'" data-vv-as="银行账号"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic11-add.bankUserAcount') }"/>
                        <p class="help is-danger" v-show="errors.has('form-invoic11-add.bankUserAcount')">${errors.first('form-invoic11-add.bankUserAcount')}</p>
                    </td></tr>
                    <tr><td class="confim_boxNum"><span></span>一般纳税人证明：</td></tr>
                    <tr style="position: relative;">
                        <td style="margin-bottom: 15px;">
                            <div class="upload_add_file" style="border: none;">
                                <div id="item_addInfo11" class="f_l" v-show="!addTaxpayerPath" style='width:100px;height:100px;border: 1px dashed #979797;'>
                                    <a data-method="notice"  id="addInfo11"></a>
                                    &lt;!&ndash;<img src="\img\icon_upload_plus.png" alt="" style="width: 24px;height:24px;margin-left:37px;margin-top: -134px;">&ndash;&gt;
                                </div>
                                <input type="hidden" class="hide" name="addTaxpayerPath" v-model="addTaxpayerPath"  class="inputW" >
                                <div class="pictureShow" v-show="addTaxpayerPath">
                                    <img class="picture" :src="addTaxpayerPath"  alt="" style="width:102px;height:102px;display: inline-block">
                                    <img src="\img\icon_upload_delete.png" class="icon_delete" @click="addTaxpayerPath = ''">
                                </div>
                            </div>
                            <p style="position: absolute;left: 135px;bottom: -128px;">一般纳税人证明可以企业对应省国税局网站查询截取如：<a style="color:rgb(35, 132, 204)">{{window.location.host}}/cooperation/addedIRS</a></p>
                            <p style="margin-top:-20px;margin-left: 110px;">请上传一般纳税人证明</p>
                        </td>
                    </tr>-->
                </table>
            </form>
        </div>

    </div>

    <!--更多发票信息-->
    <div class="moreInvoiceLists" id="moreInvoiceLists" style="display: none;">
        <div v-show="userBillInfoList.length != 0">
            <div class="moreInvoiceList1" v-for="item in userBillInfoList">
                <div style="width: 100%;height: 8px;  background-color: #a6b6c4;"></div>
                <div style="padding-left: 13px;">
                    <div class="title">
                        <h3>发票信息</h3>
                    </div>
                    <!--清除浮动-->
                    <div class="clear"></div>
                    <!-- 数据信息 还没有写隐藏的数据-->
                    <div >
                        <form >
                            <ul style="line-height: 30px;overflow: hidden">
                                <li>发票抬头：<span :title="item.unitName">${item.unitName}</span></li>
                                <li>纳税人识别号：<span :title="item.unitName">${item.taxpayerNo}</span></li>
                                <li>注册地址：<span :title="item.unitName">${item.registerAddress}</span></li>
                                <li>注册电话：<span :title="item.unitName">${item.registerPhone}</span></li>
                                <li>开户银行：<span :title="item.unitName">${item.openBank}</span></li>
                                <li>银行账号：<span :title="item.unitName">${item.bankAcount}</span></li>
                                <li id="userInvoiceLists" style="display:none;">${ item.id }</li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="basicNoinfo" v-if="userBillInfoList.length == 0" style="margin:200px auto;">
            <dl>
                <dt><img src="/img/icon-emptystate.png" /></dt>
                <dd>暂无发票信息</dd>
            </dl>
        </div>
    </div>
</div>

</div>

</div>
<script type="text/javascript" src="/js/getCookies.js"></script>
<script type="text/javascript">
    var user1 = JSON.parse(getCookie('_zg_user'));
    var pwsLength = {
        messages: {
            en: function en(field, args) {
                return args + '请输入6-20位字符';
            }
        },
        validate: function validate(value, args) {
            return value.length>=6&&value.length<=20;
        }
    };
    VeeValidate.Validator.extend('pwsLength', pwsLength);
    var qqNum = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的QQ号';
            }
        },
        validate: function validate(value, args) {
            return (/^([1-9][0-9]{5,11})$/.test(value));
        }
    };
    VeeValidate.Validator.extend('qqNum', qqNum);
    var emailNum = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的邮箱号';
            }
        },
        validate: function validate(value, args) {
            return (/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(value));
        }
    };
    var taxpayerNo = {
        messages: {
            en: function en(field, args) {
                return args + '纳税人识别必须是15-20字符';
            }
        },
        validate: function validate(value, args) {
            return (/^[A-Za-z0-9]{15,20}$/.test(value));
        }
    };
    var phone = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的电话或手机号码';
            }
        },
        validate: function validate(value, args) {
            return ((/^(1[3-9][0-9]{9})$/.test(value))|| (/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/).test(value));
        }
    };
    var tel = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的手机号码';
            }
        },
        validate: function validate(value, args) {
            return ((/^(1[3-9][0-9]{9})$/.test(value)));
        }
    };
    var num = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的银行账号！';
            }
        },
        validate: function validate(value, args) {
            return ((/\d+/.test(value)));
        }
    };
    VeeValidate.Validator.extend('num', num);
    VeeValidate.Validator.extend('tel', phone);
    VeeValidate.Validator.extend('taxpayerNo', taxpayerNo);
    var userOrderList = {{{ userOrder }}};
    var userOrderVM = new Vue({
        el:"#personCenter_all",
        delimiters: ['${', '}'],
        data:{
            url:'',
            items :userOrderList.data.list,
            totalPage:userOrderList.data.totalPage,
            totalCount:userOrderList.data.totalCount,
            pType:'',//默认查询所有
            keywords:"",//关键字查询
            keyType:3,//默认关键字类型 1 合同号 2 订单号 3 商标名称
            checkAll: false,
            //checkItems:[],
            ImgUrl:zgg.Vconfig.ImgUrl,
            isloading:false,
            currentPage:1,
            isClickLastPage:false,
            UserOrderRefundList:[],
	        modifyInfo:{},
            isCompile:'true',//切换编辑变量
            invoiceData:{},//发票数据
            //echoInvoiceData:{},
            contractUrl:zgg.Vconfig.contractUrl,
            addTaxpayerPath:'',//纳税人证明
            txtType:['jpg','png','jpeg'],
            ImgUrl:zgg.Vconfig.ImgUrl,
            demandInvoiceText: '索要发票',
            invoiceDisadled:true,
            userBillInfoList:[],
            entrustFlag : false,
            host:window.location.host,
        },
        mounted:function(){
            this.updataFile('#addInfo', 'item_addInfo', 'addTaxpayerPath'); //添加纳税人证明
            this.updataFile('#addInfo11', 'item_addInfo11', 'addTaxpayerPath'); //添加纳税人证明
        },
        created:function(){
            axios.post('/userCenter/getZgUserBillInfoList/',{mode:1}).then(function (data) {
                        userOrderVM.userBillInfoList = data.data.data;
            })
        },
        watch:{
            keyType:function(newVal,oldVal){
                switch (newVal){
                    case '1':
                        //执行代码块 11 合同号 2 订单号 3 商标名称
                        document.querySelector('#placeholderText').placeholder = '合同号';
                        break;
                    case '2':
                        //执行代码块 2
                        document.querySelector('#placeholderText').placeholder = '订单号';
                        break;
                    case '3':
                        //执行代码块 2
                        document.querySelector('#placeholderText').placeholder = '商标名称';
                        break;
                    default:
                        //n 与 case 1 和 case 2 不同时执行的代码
                        document.querySelector('#placeholderText').placeholder = '商标名称';
                }
            }
        },
        methods:{
            //
            judgeCookies:function(ptype,orderId,flowType){
                //cookies用户信息校验
                var user = JSON.parse(getCookie('_zg_user'));
                if(user.id != user1.id){
                    layui.use('layer',function(){
                        layer.open({
                            title:'提示',
                            content:'<p style="text-align: center;">该订单不属于此用户</p>',
                            btn: false
                        });
                    });
                    return;
                }
                window.open('/business/'+ptype+'/'+orderId+'/'+flowType);
                $('#url').attr('target','_blank')

            },
            //立即支付  判断当前合同是否删除
            goPlay:function (contract,orderId) {
                var user = JSON.parse(getCookie('_zg_user'));
                var uid = parseInt(user.id)
                axios.post('/userCenter/validateOrderIfSameUserByOrderId/',{"id":orderId, "uid": uid}).then(function(res){
                    if(!res.data.success){
                        layui.use('layer',function(){
                            layer.open({
                                title: '提示',
                                content: "<div>"+ res.data.message +"</div>"
                            })
                        })
                    }else{
                        axios.post('/order/getPayInfoByContractCode/',{contractCode:contract}).then(function (res) {
                            console.log(res.data.data);
                            if(res.data.success) {
                                window.open('/order/repayment/'+contract+'/'+orderId);
                            }
                        })
                    }
                })
            },
            //索要发票信息
            demandInvoice:function(Id,contract,item){
                //getInvoList(item,2)
                var user = JSON.parse(getCookie('_zg_user'));
                var uid = parseInt(user.id)
                axios.post('/userCenter/validateOrderIfSameUserByOrderId/',{"id":Id, "uid": uid}).then(function(res){
                    if(!res.data.success){
                        layui.use('layer',function(){
                            layer.open({
                                title: '提示',
                                content: "<div>"+ res.data.message +"</div>"
                            })
                        })
                    }else{
                        if(userOrderVM.demandInvoiceText == "已索要"){
                            layer.msg('已索要发票,如需修改请联系顾问!!!')
                        }else{
                            axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:Id}).then(function(res){
                                var code = res.data.code;
                                var replaceId = res.data.data.id;
                                if(res.data.data.billType) {
                                    userOrderVM.invoiceData.billType = res.data.data.billType
                                }else{
                                    userOrderVM.invoiceData.billType = 3;
                                }
                                if(res.data.data.taxpayerPath){
                                    userOrderVM.addTaxpayerPath = res.data.data.taxpayerPath;

                                }else{
                                    userOrderVM.addTaxpayerPath = null;
                                }
                                userOrderVM.invoiceData = res.data.data;
                                //userOrderVM.invoiceData = userOrderVM.echoInvoiceData;
                                
                       if(res.data.data.billType == "1"){
                           $('#billType1').css({'color':'#D9344B','border':'1px solid #D9344B'})
                           $('#billType2').css({'color':'#000','border':'1px solid #daddee'})
                       }else if(res.data.data.billType == "2" ){
                           $('#billType1').css({'color':'#000','border':'1px solid #daddee'})
                           $('#billType2').css({'color':'#D9344B','border':'1px solid #D9344B'})
                       }else if (res.data.data.billType == "3"){
                           $('#billType1').css({'color':'#000','border':'1px solid #daddee'})
                           $('#billType2').css({'color':'#000','border':'1px solid #daddee'})
                       }
                       var lay = layer.open({
                           type: 1, //页面类型
                           area:['500px','600px'], //设置宽度
                           skin: 'demandDialog', //设置样式名
                           title: '发票信息<div class="posi_abso" style="display: block"><span id="compileInvoice" class="compileInvoice">编辑</span><span id="moreInvoice" class="moreInvoice" v-if="userOrderVM.userBillInfoList">选择其他发票</span></div>', //标题
                           content:$('#dialog'), //内容
                           closeBtn: 0, //右上角关闭按钮不显示
                           btn:['保存','取消'],
                           offset:'50px',
                           btnAlign: 'c' ,//按钮居中对齐
                           move: false,
                           scrollbar: false,
                           success:function(){
                               //$('.layui-layer-content').height(474)
                               console.log($('.layui-layer-content'))
                               //点击索要发片之后的编辑事件
                               $("#compileInvoice").on('click',function(){
                                   if(userOrderVM.isCompile){
                                       console.log( typeof userOrderVM.invoiceData.billType)
                                       if(userOrderVM.invoiceData.billType == 1 || userOrderVM.invoiceData.billType == 3 || typeof userOrderVM.invoiceData.billType == 'undefined'){
                                           userOrderVM.invoiceData.billType = 1;
                                       }else if (userOrderVM.invoiceData.billType == 2) {
                                           userOrderVM.invoiceData.billType == 2
                                       }
                                       //userOrderVM.invoiceData.billType = userOrderVM.invoiceData.billType ? userOrderVM.invoiceData.billType : 1;
                                       userOrderVM.isCompile = false;
                                       $(".posi_abso").css('display','none')
                                       if(userOrderVM.invoiceData.billType == 1){
                                           $('#billType1').css({'color':'#D9344B','border':'1px solid #D9344B'})
                                           $('#billType2').css({'color':'#000','border':'1px solid #daddee'})
                                       }else if(userOrderVM.invoiceData.billType == 2){
                                           $('#billType1').css({'color':'#000','border':'1px solid #daddee'})
                                           $('#billType2').css({'color':'#D9344B','border':'1px solid #D9344B'})
                                       }
                                   }
                               })//end
                               //点击索要发票之后选取更多事件
                               $("#moreInvoice").on('click',function(){
                                   layer.close(lay)
                                   axios.post('/userCenter/getZgUserBillInfoList/',{mode:1}).then(function (data) {
                                       userOrderVM.userBillInfoList = data.data.data;
                                       setTimeout(function(){
                                           var lay2 = layer.open({
                                               type: 1,
                                               area:[ '930px','700px'], //设置宽度
                                               title: '选择更多',
                                               content: $('#moreInvoiceLists'),
                                               btn:['保存'],
                                               scrollbar: false,
                                               success:function(){
                                                   $('.moreInvoiceList1').on('click',function(){
                                                       $(this).addClass('chechInvoice').siblings().removeClass('chechInvoice');
                                                   })
                                               },
                                               btn1:function(){
                                                   var id = $('.chechInvoice').find('#userInvoiceLists').html();
                                                   if(userOrderVM.userBillInfoList.length != 0 ){
                                                       if(!id){
                                                           layer.msg('请选择发票信息')
                                                       }else if(id){
                                                           setTimeout(function(){
                                                               axios.post('/userCenter/getZgUserBillInfoListById/',{id:id}).then(function(res){
                                                                   var data = res.data.data[0];
                                                                   data.billType = 3;
                                                                   //data.billStatus = userOrderVM.invoiceData.billStatus;
                                                                   data.id = replaceId ;
                                                                   data.contractCode = contract;
                                                                   if(!data.taxpayerPath){
                                                                       data.taxpayerPath = "";
                                                                   }
                                                                   if(data.taxpayerPath){
                                                                       data.taxpayerPath = '/base' + data.taxpayerPath.split('/base')[1];
                                                                   }
                                                                   if(code == 'E00002'){
                                                                       axios.post('/userCenter/saveZgVatInfo',data).then(function(res){
                                                                           setTimeout(function(){userOrderVM.demandInvoice(Id,contract);layer.close(lay2)},50)
                                                                       });
                                                                   }else{

                                                                       axios.put('/userCenter/updateZgVatInfo/',data).then(function(res){
                                                                           console.log(res)
                                                                           userOrderVM.addTaxpayerPath = res.data.data.taxpayerPath;
                                                                           setTimeout(function(){layer.close(lay2);userOrderVM.demandInvoice(Id,contract);},100)
                                                                       });
                                                                   }
                                                               })
                                                           },200)
                                                       }
                                                   }else if(userOrderVM.userBillInfoList.length == 0 ){
                                                       setTimeout(function(){layer.close(lay2);userOrderVM.demandInvoice(Id,contract);},50)
                                                   }
                                               }
                                           })
                                       },50)
                                   });


                                        })//end
                                        //点击普票专票选项
                                        $('.confim_invoceLi').on('click','li',function(){
                                            $(this).css({'color':'#D9344B','border':'1px solid #D9344B'}).siblings().css({'color':'#000','border':'1px solid #daddee'});
                                            userOrderVM.errors.clear('form-invoic-add');
                                            userOrderVM.errors.clear('form-invoic11-add');
                                        })
                                    },
                                    //保存按钮
                                    yes:function(){
                                        axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:Id}).then(function(res){
                                         if(res.data.data.billType == 1 || res.data.data.billType == 2){
                                                layer.msg('已索要',{icon:2})
                                            }else{
                                                userOrderVM.invoiceData.contractCode = contract;
                                                //点击保存  根据code判断是修改还是新增;
                                                //如果用户没有选择专票或者普票
                                                if(userOrderVM.invoiceData.billType == 3){
                                                    layer.msg('请选择发票类型！！！')
                                                }
                                                if(code == 'E00002'){
                                                    layer.msg('暂无发票信息！！！请点击编辑')
                                                }
                                                //为专票普票判断提交
                                                if(userOrderVM.invoiceData.billType == 1){
                                                    userOrderVM.$validator.validateAll('form-invoic11-add').then(function (result) {
                                                        if(result){
                                                            if(userOrderVM.invoiceData.taxpayerPath){
                                                                userOrderVM.invoiceData.taxpayerPath = '/base' + userOrderVM.invoiceData.taxpayerPath.split('/base')[1];
                                                            }
                                                            if(code == 0 ){
                                                                if(userOrderVM.invoiceData.billType == 3){
                                                                    layer.msg("请选择发票类型！！！",{icon:2})
                                                                }else{
                                                                    axios.put('/userCenter/updateZgVatInfo/',userOrderVM.invoiceData).then(function(res){
                                                                        layer.msg("索要成功！！！",{icon:1});
                                                                        layer.close(lay)
                                                                    });
                                                                }
                                                            }else if(code == 'E00002'){
                                                                axios.post('/userCenter/saveZgVatInfo', userOrderVM.invoiceData).then(function (res) {
                                                                    layer.msg("索要成功！！！", {icon: 1});
                                                                    layer.close(lay);
                                                                });
                                                            }
                                                        }
                                                    },function(){
                                                        $(".posi_abso").css('display','none');
                                                        userOrderVM.isCompile = false;
                                                    })
                                                }else if(userOrderVM.invoiceData.billType == 2){
                                                    userOrderVM.$validator.validateAll('form-invoic-add').then(function (result) {
                                                        if(result){
                                                            if(userOrderVM.invoiceData.taxpayerPath){
                                                                userOrderVM.invoiceData.taxpayerPath = '/base' + userOrderVM.invoiceData.taxpayerPath.split('/base')[1];
                                                            }
                                                            if(code == 0 ){
                                                                if(userOrderVM.invoiceData.billType == 3){
                                                                    layer.msg("请选择发票类型！！！",{icon:2})
                                                                }else{
                                                                    axios.put('/userCenter/updateZgVatInfo/',userOrderVM.invoiceData).then(function(res){
                                                                        layer.msg("索要成功！！！",{icon:1});
                                                                        layer.close(lay)
                                                                    });
                                                                }
                                                            }else if(code == 'E00002'){
                                                                if(userOrderVM.invoiceData.billType == 3){
                                                                    layer.msg("请选择发票类型！！！",{icon:2})
                                                                }else {
                                                                    axios.post('/userCenter/saveZgVatInfo', userOrderVM.invoiceData).then(function (res) {
                                                                        layer.msg("索要成功！！！", {icon: 1});
                                                                        layer.close(lay)
                                                                    });
                                                                }
                                                            }
                                                        }
                                                    },function(){
                                                        //layer.msg('请点击编辑！！！',{icon:2})
                                                        $(".posi_abso").css('display','none')
                                                        userOrderVM.isCompile = false;
                                                    })
                                                }
                                            }
                                        })

                                    },


                           //取消按钮
                           btn2:function(){
                               if(userOrderVM.isCompile == false){
                                   axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:Id}).then(function(res){
                                       userOrderVM.invoiceData = res.data.data;
                                       userOrderVM.addTaxpayerPath = res.data.data.taxpayerPath;
                                       userOrderVM.isCompile = true;
                                       $('#billType1').css({'color':'#000','border':'1px solid #daddee'});
                                       $('#billType2').css({'color':'#000','border':'1px solid #daddee'});
                                       $(".posi_abso").css('display','block');
                                   })


                                        }else{
                                            layer.close(lay)
                                        }

                                        return false;
                                    },
                                });
                            });
                        }
                    }
                })

            },//索要发票信息弹出框关闭
            //上传图片
            updataFile:function (_str,queId,imgUrl,other) {
                if(navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion .split(";")[1].replace(/[ ]/g,"")=="MSIE9.0") {
                    var _fileSizeLimit =  '2MB', _fileTypeExts = '*.jpg;*.bmp;*.jpeg;*.png;*.gif;';
                    if(_oth === 'other' ){
                        _fileSizeLimit =  '100MB';
                        _fileTypeExts = '*.jpg;*.gif;*.png;*.bmp;*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.pdf;*.txt;*.rar;*.zip';
                    }
                    $(_str).uploadify({
                        'auto' : true,
                        'queueID' : queId,
                        'checkScript':'/upload/check',
                        'uploadScript' : '/upload/profile',
                        'buttonCursor':'hand',
                        'buttonText':'',
                        "buttonClass":"addFile",
                        'width': 90,
                        'method' : 'post',
                        'fileSizeLimit ': 1024 * 1024 * 2,
                        'fileType': '*.jpg;*.jpeg;*.png;',
                        'progressData':'percentage',
                        'formData':{
                            'fType':"ft_8"
                        },
                        'onDrop':function(file, fileDropCount) {
                            debugger;
                        },
                        'onFallback':function () {
                            alert('请安装或升级更高版本的Flash插件');
                        },
                        'onUploadComplete' : function(file, data, response) {
                            if(imgUrl == 'addTaxpayerPath'){
                                userOrderVM.invoiceData.taxpayerPath = userOrderVM. contractUrl + JSON.parse(data).data.filePath;
                                userOrderVM.addTaxpayerPath =  userOrderVM.invoiceData.taxpayerPath;
                            }
                            layer.msg('上传成功',{icon:1});
                        },
                        'onCheck'  : function(file, exists) {
                            if (userOrderVM.txtType.indexOf(file.name.split(".")[file.name.split(".").length - 1]) == -1) {
                                layer.msg("请上传jpg,png,jpeg,pdf格式图片！");
                                $(_str).uploadifive('cancel', file)
                            }
                        },
                        'onError' : function (file, data, response) {
                            debugger;
                        }
                    })
                }else{
                    $(_str).uploadifive({
                        'auto' : true,
                        'queueID' : queId,
                        'checkScript':'/upload/check',
                        'uploadScript' : '/upload/profile',
                        'buttonCursor':'hand',
                        'buttonText':'',
                        "buttonClass":"addFile",
                        'width': 90,
                        'method' : 'post',
                        'fileSizeLimit ': 1024 * 1024 * 2,
                        'fileType': '*.jpg;*.jpeg;*.png;',
                        'progressData':'percentage',
                        'formData':{
                            'fType':"ft_8"
                        },
                        'onDrop':function(file, fileDropCount) {
                            debugger;
                        },
                        'onUploadComplete' : function(file, data, response) {
                            if(imgUrl == 'addTaxpayerPath'){
                                userOrderVM.invoiceData.taxpayerPath = userOrderVM. contractUrl + JSON.parse(data).data.filePath;
                                userOrderVM.addTaxpayerPath =  userOrderVM.invoiceData.taxpayerPath;
                            }
                            layer.msg('上传成功',{icon:1});
                        },
                        'onCheck'  : function(file, exists) {
                            if (userOrderVM.txtType.indexOf(file.name.split(".")[file.name.split(".").length - 1].toLowerCase()) == -1) {
                                layer.msg("请上传jpg,png,jpeg格式图片！");
                                $(_str).uploadifive('cancel', file)
                            }
                        },
                        'onError' : function (file, data, response) {
                            debugger;
                        }
                    })
                }
            },

            validateForm:function(scope) {
                this.$validator.validateAll(scope).then(function(result) {
                    if (result) {
                        // eslint-disable-next-line
                        /* alert('Form Submitted!');*/
                        if(scope == 'form-1'){
                            orderVM.billTextName = orderVM.billName;
                        }
                        if(scope == 'form-2'){
                            orderVM.billTextName = orderVM.zgVatInfo.unitName;
                        }
                        orderVM.billTypeTemp =  orderVM.billType;
                        layer.close(addressOpen);
                        $("#BillBox").hide();
                    }
                });
            },

















            //关键字搜索订单
            searchData:function () {
                var partter= /^[A-Za-z0-9\u4e00-\u9fa5\+\-]+$/;
                if(!partter.test(this.keywords) && this.keywords.length != 0){
                    layer.msg('只能输入数字、英文、汉字及 + 和 - 字符！')
                    return
                }
                this.pType != -1?this.getPagesData():this.getRefundPagesData();
            },
            getPagesData:function( ){
                var _self = this;
                var _params = {keyWord:this.keywords,payStatus:this.pType,pageNo:userOrderVM.currentPage,pageSize:10};
                if($.trim(this.keywords)!=""){
                    _params.keyType = this.keyType;
                }
                axios.post('/userOrder',_params).then(
                        function (res) {
                            if(res.data.success && res.data.data){
                                _self.items = res.data.data.list;
                                if(userOrderVM.currentPage == 1 || userOrderVM.isClickLastPage){
                                    userOrderVM.totalPage = 1;
                                    userOrderVM.totalCount = res.data.data.totalCount;
                                    userOrderVM.isClickLastPage = false;
                                    _self.pages();
                                }
                            }
                        },
                        function (err) {
                            layer.msg(err, {
                                icon: 5
                                ,time: 3*1000 //3s后自动消失
                            })
                        }
                )
            },
            //获取未付款订单列表
            getRefundPagesData:function () {
                var _self = this;
                var _params = {keyWord:this.keywords,pageNo:userOrderVM.currentPage,pageSize:10};
                if($.trim(this.keywords)!=""){
                    _params.keyType = this.keyType;
                }
                axios.post('/userOrder/getZgOrderRefundList',_params).then(
                        function (res) {
                            if(res.data.success && res.data.data){
                                _self.UserOrderRefundList = res.data.data.list||[];
                                if(userOrderVM.currentPage == 1){
                                    userOrderVM.totalPage = 1;
                                    userOrderVM.totalCount = res.data.data.totalCount;
                                    _self.refundPages();
                                }
                            }
                        },
                        function (err) {
                            layer.msg(err, {
                                icon: 5
                                ,time: 3*1000 //3s后自动消失
                            })
                        }
                )
            },
            setCheckAll:function () {
               if(this.pType == -1) return;
               var falg = this.checkAll = !this.checkAll;
                this.items.forEach(function (item) {
                    item.zgOrderMainDetailList.forEach(function (childer) {
                        if ((childer.pcode.indexOf("tr_refr") > -1) || (childer.pcode == "tr_reg_11") || (childer.pcode.startsWith("cr") || childer.pcode.startsWith("pt_ow") || childer.pcode.startsWith("x-")) || (!childer.canEntrust)) {
                            Vue.set(childer,"ischeck", 'false');
                        }else{
                            if (childer.payStatus == 1){
                                Vue.set(childer,"ischeck", falg);
                            }else{
                                Vue.set(childer,"ischeck", 'false');
                            }
                        }
                    })
                })
            },
            setItemCheck:function (item) {
                Vue.set(item,"ischeck", !item.ischeck);
                var isNoCheck = false
                this.items.forEach(function (item) {
                    item.zgOrderMainDetailList.forEach(function (childer) {
                        if(!childer.ischeck){
                            isNoCheck = true
                        }
                    })
                })
                this.checkAll = !isNoCheck;
            },
            //一键委托
            entrust:function () {
               if(this.checkItems.length>0){
                   axios.post('/userOrder/entrust',{orderIdVoList:this.checkItems}).then(
                           function (res) {
                               if(res.data.success && res.data.data){
                                   layer.msg('委托订单成功！！！', {
                                       icon: 1
                                       ,time: 3*1000 //3s后自动消失
                                   })
                                   userOrderVM.items.forEach(function (item) {
                                       item.zgOrderMainDetailList.forEach(function (childer) {
                                           if (childer.ischeck == true ) {
                                               childer.isentrust = 1;
                                           }
                                       });
                                   });
                                   userOrderVM.checkAll = false;
                               }
                           },
                           function (err) {
                               layer.msg(err, {
                                   icon: 5
                                   ,time: 3*1000 //3s后自动消失
                               })
                           }
                   )
               }
            },
            //合同状态判断 type 0移入  1移出
//            handleHoverItem:function (event,item,type) {
//               if(typeof  item.ContracStatus == "undefined"){
//                   this.convertUserOrderList.map(function (list) {
//                       if(list.id == item.id){
//                           Vue.set(item,'isloading',false);
//                       }else{
//                           Vue.set(list,'isloading',true);
//                       }
//                   })
//                   $(event.currentTarget).find(".personal_order").show();
//                   if(item.contractCode){
//                       axios.get('/userOrder/getContracStatus/'+item.contractCode).then(
//                               function (res) {
//                                   if(res.data.success && res.data.data){
//                                        Vue.set(item,'ContracStatus',res.data.data);
//                                        item.isloading = false;
//                                   }
//                               },
//                               function (err) {
//                                   console.log(err);
//                               }
//                       )
//                   }
//               }else{
//                   Vue.set(item,'isloading',true);
////                   $(event.currentTarget).find(".personal_order").stop().slideToggle();
////                   $(event.currentTarget).find(".personal_order").hide();
//               }
//            },
            handleHoverItem:function (event,item,type) {
                /*闪烁问题是当鼠标移动的时候，return false 不做任何操作*/
                //(item.zgOrderMainDetailList[0].orderCode)
               switch(type){
                   case 0:
                       getInvoList(item);
                       if(typeof  item.ContracStatus == "undefined"){
                           $(event.currentTarget).find(".personal_order").show();
                           Vue.set(item,'isloading',true);
                           if(item.contractCode){
                           axios.get('/userOrder/getContracStatus/'+item.contractCode+"?"+new Date().getTime()).then(
                                   function (res) {
                                       if(res.data.success && res.data.data){
                                            Vue.set(item,'ContracStatus',res.data.data);
                                            item.isloading = false
                                       }
                                   },
                                   function(err){

                                   }
                               )
                           }
                       }else{
                           $(event.currentTarget).find(".personal_order").show();
                       }
                       break;
                   case 1:
                       $(event.currentTarget).find(".personal_order").hide();
                       break;
                   case 2:
                       return false;
               }
            },
            //合同确认
            contractFile:function (item) {
                var user = JSON.parse(getCookie('_zg_user'));
                var uid = parseInt(user.id)
                axios.post('/userCenter/validateOrderIfSameUserByOrderId/',{"id":item.zgOrderMainDetailList[0].orderId, "uid": uid}).then(function(res){
                    if(!res.data.success){
                        layui.use('layer',function(){
                            layer.open({
                                title: '提示',
                                content: "<div>"+ res.data.message +"</div>"
                            })
                        })
                    }else{
                        var pCode = item.zgOrderMainDetailList[0].pcode;

                        if(item.zgOrderMainDetailList[0].pcode == "ht_ent_0001"){  //高新培育
                            window.open('/userOrder/showOrderContract/'+"ht_ent_0001/"+ item.contractCode);
                        }else if(item.zgOrderMainDetailList[0].pcode == "ht_ent_0002"){  //高新企业认定（果益版）
                            window.open('/userOrder/showOrderContract/'+"ht_ent_0002/"+ item.contractCode);
                        }else if(item.zgOrderMainDetailList[0].pcode == "ht_ent_0003"){  //ht_003高新企业认定（保过版）
                            window.open('/userOrder/showOrderContract/'+"ht_ent_0003/"+ item.contractCode);
                        }else if(item.zgOrderMainDetailList[0].pcode == "ht_ent_0004"){  //地方高新申报
                            window.open('/userOrder/showOrderContract/'+"ht_ent_0004/"+ item.contractCode);
                        }else{
                            window.open('/userOrder/showOrderContract/'+item.ptype+"/"+ item.contractCode);
                        }
                    }
                })

            },
            //删除合同
            deleteContract:function (item) {
                var _self = this;
                layer.open({
                    type: 1,
                    title: "删除合同",//false不显示标题栏,
                    area: '480px;',
                    shade: 0.6,
                    id: 'LAY_layuipro_delete' ,//设定一个id，防止重复弹出,
                    btn: ['取消', '确定'],
                    moveType: 1 ,//拖拽模式，0或者1,
                    content: '<div style="padding:30px 25px;font-size: 16px;color: #2a2a2a;">尊敬的用户：该合同下的所有订单将被删除，是否继续？</div>',
                    success: function (layero) {
                    },
                    btn1:function(layero){
                        layer.closeAll();
                    },
                    btn2:function(layero){
                        axios.post('/userOrder/deleteContract',{contractCode:item.contractCode}).then(
	                        function (res) {
		                        if (res.data.code == 0) {
			                        layer.msg("合同" + item.contractCode + "删除成功", {
				                        icon: 1
				                        , time: 3 * 1000 //3s后自动消失
			                        })
			                        userOrderVM.items.splice(userOrderVM.items.indexOf(item), 1);
			                        //如果删除合同是最后一条重新获取数据
			                        if (userOrderVM.items.length != 0 && userOrderVM.currentPage != 1) {
				                        axios.post('/userOrder', {
					                        keyWord: this.keywords,
					                        payStatus: this.pType,
					                        pageNo: userOrderVM.currentPage,
					                        pageSize: 10
				                        }).then(
					                        function (res) {
						                        if (res.data.success && res.data.data) {
							                        _self.items = res.data.data.list;
							                        userOrderVM.totalPage = userOrderVM.currentPage;
							                        userOrderVM.totalCount = res.data.data.totalCount;
							                        _self.pages();
						                        }
					                        },
					                        function (err) {
						                        layer.msg(err, {
							                        icon: 5
							                        , time: 3 * 1000 //3s后自动消失
						                        })
					                        }
				                        )
			                        }
			                        if (userOrderVM.items.length == 0 && userOrderVM.currentPage != 1) {
				                        userOrderVM.currentPage = userOrderVM.currentPage - 1;
				                        userOrderVM.isClickLastPage = true;
				                        axios.post('/userOrder', {
					                        keyWord: this.keywords,
					                        payStatus: this.pType,
					                        pageNo: userOrderVM.currentPage,
					                        pageSize: 10
				                        }).then(
					                        function (res) {
						                        if (res.data.success && res.data.data) {
							                        _self.items = res.data.data.list;
							                        userOrderVM.totalPage = userOrderVM.currentPage;
							                        userOrderVM.totalCount = res.data.data.totalCount;
							                        _self.pages();
							                        if (userOrderVM.currentPage == 1) {
								                        $(".layui-this").click();
							                        }
						                        }
					                        },
					                        function (err) {
						                        layer.msg(err, {
							                        icon: 5
							                        , time: 3 * 1000 //3s后自动消失
						                        })
					                        }
				                        )
			                        }
			                        if (userOrderVM.currentPage == 1) {
				                        userOrderVM.isClickLastPage = true;
				                        axios.post('/userOrder', {
					                        keyWord: this.keywords,
					                        payStatus: this.pType,
					                        pageNo: userOrderVM.currentPage,
					                        pageSize: 10
				                        }).then(
					                        function (res) {
						                        if (res.data.success && res.data.data) {
							                        _self.items = res.data.data.list;
							                        userOrderVM.totalPage = userOrderVM.currentPage;
							                        userOrderVM.totalCount = res.data.data.totalCount;
							                        $(".layui-this").click();
						                        }
					                        },
					                        function (err) {
						                        layer.msg(err, {
							                        icon: 5
							                        , time: 3 * 1000 //3s后自动消失
						                        })
					                        }
				                        )
			                        }
		                        }
	                        },
	                        function (err) {
	                        }
                        )
                    }
                })
            },
            //解锁合同
            cancelContract:function (item) {
                layer.open({
                    type: 1,
                    title: "解除合同",//false不显示标题栏,
                    area: '480px;',
                    shade: 0.6,
                    id: 'LAY_layuipro' ,//设定一个id，防止重复弹出,
                    btn: ['取消', '确定'],
                    moveType: 1 ,//拖拽模式，0或者1,
                    content: '<div style="padding:30px 25px;font-size: 16px;color: #2a2a2a;">尊敬的用户：该合同下的所有订单将被解锁，是否继续？</div>',
                    success: function (layero) {
                    },
                    btn1:function(layero){
                        layer.closeAll();
                    },
                    btn2:function(layero){
                        axios.get('/userOrder/cancelContract/'+item.contractCode).then(
                            function(res){
                                if(res.data.code ==0 ){
                                    layer.msg("合同"+item.contractCode+"解锁成功", {
                                       icon: 1
                                       ,time: 3*1000 //3s后自动消失
                                    })
                                    //item.ContracStatus = 2;
                                    //Vue.set(item,'contractStatus',"2");
                                    window.location.reload();
                                }
                            },
                            function(err){
                            }
                       )
                    }
                })
            },
            downFile:function (item) {
                axios.get('/userOrder/downContractFile/'+item.ptype+"/"+item.contractCode).then(
	                function (res) {
		                if (res.data.success && res.data.data) {
                            /* Vue.set(item,'ContracStatus',res.data.data);*/
			                item.isloading = false
			                window.open('/userOrder/downContractByPathConcode/' + escape(res.data.data) + "/" + item.contractCode)
		                }
	                },
	                function (err) {
	                }
                )
            },
            //全部订单分页
            pages:function () {
                
                layui.use(['laypage', 'layer'], function(){
                    var laypage = layui.laypage,
                            layer = layui.layer;
                    laypage({
                        cont: 'demo4',
                        curr: userOrderVM.totalPage,
                        pages: Math.ceil(parseInt(userOrderVM.totalCount)/10),
                        skip: true,
                        first: false,
                        last: false,
                        groups:5,
                        jump: function (e) {
                            if(e.curr !=1 || userOrderVM.currentPage>1){
                                userOrderVM.currentPage = e.curr;
                                userOrderVM.getPagesData();
                                userOrderVM.checkAll = false;
                            }
                        }
                    });
                })
            },
            refundPages:function () {
                layui.use(['laypage', 'layer'], function(){
                    var laypage = layui.laypage,
                            layer = layui.layer;
                    laypage({
                        cont: 'demo5',
                        curr: userOrderVM.totalPage,
                        pages: Math.ceil(parseInt(userOrderVM.totalCount)/10),
                        skip: true,
                        first: false,
                        last: false,
                        groups:5,
                        jump: function (e) {
                            if(e.curr !=1 || userOrderVM.currentPage>1){
                                userOrderVM.currentPage = e.curr;
                                userOrderVM.getRefundPagesData();
                                userOrderVM.checkAll = false;
                            }
                        }
                    });
                })
            },

            /**
             *  查看变更
             */
            couchDBStore: function (item) {
            	debugger;
	            axios.get('/userOrder/getModifyInfo/' + item.orderId).then(
		            function (res) {
			            if(res.data.success && res.data.data){
				            userOrderVM.modifyInfo = res.data.data;
				            userOrderVM.payStatus = item.payStatus;
				            debugger;
				            layer.open({
					            type: 1,
					            title: "<span class='titleFlag'></span>查看变更",//false不显示标题栏,
					            area: ['846px', '400px'],
					            shade: 0.6,
					            id: 'couchDBStore' ,//设定一个id，防止重复弹出,
					            moveType: 1 ,//拖拽模式，0或者1,
					            content: $("#changelog"),
					            success: function (layero) {
					            },
					            btn1:function(layero){
						            layer.closeAll();
					            },
					            btn2:function(layero){

					            }
				            })
			            }
		            }
	            );
            }
	    },
        computed:{
            checkItems:function () {
                var isCheckFalgList = []
                this.items.forEach(function (item) {
                    item.zgOrderMainDetailList.forEach(function (childer) {
                        if(childer.ischeck == true){
                            if(childer.isentrust != 1){
                                isCheckFalgList.push({orderId:childer.orderId});
                            }
                        }
                    })
                })
                return isCheckFalgList;
            },
            convertUserOrderList:function () {
                pType = this.pType;
                return this.items.filter(function (data) {
                    data.zgOrderMainDetailList.forEach(function (childer) {
                        if(childer.payStatus == 1){
                            data.isShow = true;
                        }
                        if(childer.ptype == 'x-' && childer.payStatus == 1){
                            data.isDownLine = true;
                        }
                    });
                    if(pType == "") return true;
                  /*  item.zgOrderMainDetailList.forEach(function (childer) {
                        if(childer.payStatus == ''){
                            childer.serviceName = "知果果自营"
                        }else{
                            childer.serviceName = childer.serviceName+childer.companyName
                        }
                    })*/
                    return data.zgOrderMainDetailList[0].payStatus == pType;
                });
            },
	        
        }
     })
    userOrderVM.pages();
    function getInvoList(item){
        console.log(item)
        axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:item.zgOrderMainDetailList[0].orderId}).then(function(res){
            if(res.data.data.billType == 1 || res.data.data.billType == 2){
                Vue.set(userOrderVM,'demandInvoiceText',"已索要");
               /* if(type == 2){
                    layer.msg('此合同已经索要发票！！！')
                }*/
                //userOrderVM.invoiceDisadled = true;
            }else if(res.data.data.billType == 3 || res.data.code == 'E00002'){
                Vue.set(userOrderVM,'demandInvoiceText',"索要发票");
                //userOrderVM.invoiceDisadled = false;
            };
            setTimeout(function(){isSend = false;},50)
        })

    }
</script>
