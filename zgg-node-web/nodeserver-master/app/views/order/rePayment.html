<link rel="stylesheet" href="/css/confimProduct.css">
<link rel="stylesheet" href="/css/my_coupon.css" >
<script src="/js/qrcode.min.js" type="text/javascript"></script>
<style>
    .layui-layer-btn {
        text-align: center;
    }

    .confimCont_left:nth-child(3){
        clear: both;
    }
    .confimCont_left:nth-child(5){
        clear: both;
    }
   /* .confimCont_left:nth-child(4){
        clear: both;
    }*/
    .confim_boxNum p.order_addedIRS,.confim_boxNum p.order_addedIRS1{
        position: absolute;left: 140px;bottom: 135px;font-size: 12px;width: 340px;
    }
    @media screen and (max-width: 1366px) {
        .confim_boxNum p.order_addedIRS {
            bottom:5px;
        }

        .confim_boxNum p.order_addedIRS1 {
            bottom:5px;
        }
    }
</style>
<div class="confimWrapp" id="order" v-cloak>
    <div class="hide" id="BillBox">
        <div class="confim_invoceInfo" >
            <div class="confim_divTtpe">发票类型：</div>
            <ul class="confim_invoceLi">
                <li @click="billType=0" :class="{'confim_chenckRed':billType==0}">增值税普通发票</li>
                <li @click="billType=1" :class="{'confim_chenckRed':billType==1}">增值税专用发票</li>
            </ul>
            <div class="clear"></div>
            <div class="confim_divCon">
                <form @submit.prevent="validateForm('form-1')" data-vv-scope="form-1">
                    <table class="confim_box" v-show="billType==0"><tr><td class="confim_boxNum"><span>*</span>单位名称：</td></tr>
                        <tr><td><input type="text" v-validate="'required'" v-model="billName" name="billName" data-vv-as="单位名称" :class="{'input': true, 'is-danger': errors.has('form-1.billName') }" /><p class="help is-danger" v-show="errors.has('form-1.billName')">${ errors.first('form-1.billName') }</p></td></tr>
                    </table>
                </form>
                <form @submit.prevent="validateForm('form-2')" data-vv-scope="form-2">
                    <table class="confim_box" v-show="billType==1"><tr><td class="confim_boxNum"><span>*</span>单位名称：</td></tr>
                        <tr><td><input type="text" v-model="zgVatInfo.unitName" v-validate="'required'" data-vv-as="单位名称" name="unitName" :class="{'input': true, 'is-danger': errors.has('form-2.unitName') }" /><p class="help is-danger" v-show="errors.has('form-2.unitName')">${ errors.first('form-2.unitName') }</p></td></tr>
                        <tr><td class="confim_boxNum"><span>*</span>纳税人识别码：</td></tr>
                        <tr><td><input type="text" name="taxpayerNo" v-model="zgVatInfo.taxpayerNo" data-vv-as="纳税人识别码" v-validate="'taxpayerNo|required'" :class="{'input': true, 'is-danger': errors.has('form-2.taxpayerNo') }"/><p  class="help is-danger" v-show="errors.has('form-2.taxpayerNo')">${ errors.first('form-2.taxpayerNo') }</p></td></tr>
                        <tr><td class="confim_boxNum"><span>*</span>注册地址：</td></tr>
                        <tr><td><input type="text" name="registerAddress" v-model="zgVatInfo.registerAddress" data-vv-as="注册地址" v-validate="'required'" :class="{'input': true, 'is-danger': errors.has('form-2.registerAddress') }" /><p class="help is-danger" v-show="errors.has('form-2.registerAddress')">${ errors.first('form-2.registerAddress') }</p></td></tr>
                        <tr><td class="confim_boxNum"><span>*</span>注册电话：</td></tr>
                        <tr><td><input type="text" v-model="zgVatInfo.registerPhone" v-validate="'phone|required'" data-vv-as="注册电话" name="registerPhone" :class="{'input': true, 'is-danger': errors.has('form-2.registerPhone') }"/><p class="help is-danger" v-show="errors.has('form-2.registerPhone')">${ errors.first('form-2.registerPhone') }</p></td></tr>
                        <tr><td class="confim_boxNum"><span>*</span>开户银行：</td></tr>
                        <tr><td><input type="text" v-model="zgVatInfo.openBank" v-validate="'required'" data-vv-as="开户银行"  name="openBank" :class="{'input': true, 'is-danger': errors.has('form-2.openBank') }"/><p class="help is-danger" v-show="errors.has('form-2.openBank')">${ errors.first('form-2.openBank') }</p></td></tr>
                        <tr><td class="confim_boxNum"><span>*</span>银行账户：</td></tr>
                        <tr><td><input type="text" v-model="zgVatInfo.bankAcount" v-validate="'numeric|required'" data-vv-as="银行账户"  name="bankAcount" :class="{'input': true, 'is-danger': errors.has('form-2.bankAcount') }"/><p class="help is-danger" v-show="errors.has('form-2.bankAcount')">${ errors.first('form-2.bankAcount') }</p></td></tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
    <div class="confimContent">
        <div class="confimTit">确认商品信息</div>
        <div class="confimInfo">
            <ul>
                <li class="confimLi1">商品信息</li>
                <li class="confimLi2">单价</li>
                <li class="confimLi3">数量</li>
                <li class="confimLi4">小计</li>
            </ul>
            <div v-for="item in confimProduct">
                <div class="clear"></div>
                <div class="confimDetails">
                    <dl>
                        <dt><img :src="!!item.picsSmall?ImgUrl+item.picsSmall:'/img/empty-no-image.png'"/></dt>
                        <dd>
                            <p v-html="item.pname"></p>
                            <div v-if="item.orderFeeChargeds.length>0"  v-for="sc in item.orderFeeChargeds" >${sc.feeChargedTypename}：
                                <span v-if="sc.buyNum!=item.category" v-html="sc.feeChargedName" ></span>
                                <span v-if="sc.buyNum==item.category" v-html="sc.buyNum" ></span>
                            </div>
                        </dd>
                    </dl>
                    <div class="confimUnit">${ item.money+item.cdkmoney}</div>
                    <div class="confimNum">x<span>1</span></div>
                    <div class="confimTotal">${item.money}<br> <span style="font-size: 12px;color: red;" v-if="item.cdkmoney">(含${item.cdkmoney}元优惠)</span>  </div>
                </div>
            </div>
        </div>
        <div class="confimTit">确认联系信息</div>
        <div class="confimContacts">
            <div class="confimCont_left box_color_c box_choice" :class="{'confim_checkClick':recipientId==add.id,'isEdit':add.isEdit}"  v-for="add in addressList" v-if="add.isDefault==1" @click="recipientId=add.id">
                <div><img src="/img/confimCont_bg.png"/></div>
                <div class="confimTop">
                    <h3>收件人信息</h3>
                    <p class="dis_p" v-if="add.isDefault!=1" @click.stop="deleteAddress(add)">删除</p>
                    <p class="confim_edit" data="true">
                        <span class="edit_es" @click.stop="editAddress(add)">编辑</span>
                        <span class="save_es" @click.stop="saveAddress(add)">保存</span></p>
                </div>
                <div class="clear"></div>
                <div class="confimEdit">
                    <form :data-vv-scope="'formA_'+add.id">
                        <ul class="edit_change" v-show="!add.isEdit">
                            <li>姓名：<span v-html="add.recipientName"></span></li>
                            <li>手机号码：<span v-html="add.recipientPhone"></span></li>
                            <li>地址：
                                <span v-if="add.country" v-html="add.provinceDesc+add.cityDesc+add.countryDesc+add.recipientAddress"></span>
                                <span v-if="!add.country" v-html="add.provinceDesc+add.cityDesc+add.recipientAddress"></span>
                            </li>
                        </ul>
                        <ul  v-show="add.isEdit" >
                            <li>姓名：
                                <input type="text" class="layui-input" v-model="add.recipientName" v-validate="'required'" data-vv-as="姓名"  name="recipientName" :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientName') }"/><p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientName')">${ errors.first('formA_'+add.id+'.recipientName') }</p>
                            </li>
                            <li>手机号码：
                                <input type="text" class="layui-input" v-model="add.recipientPhone" data-vv-as="手机号码" name="recipientPhone" v-validate="'phone|required'"
                                       :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientPhone') }"/>
                                <p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientPhone')">${ errors.first('formA_'+add.id+'.recipientPhone') }</p>
                            </li>
                            <li class="addressLi">
                                <div>地址</div>
                                <select class="address-select" name="quiz1" v-model="add.province"  @change="tre_city(add,1)"
                                        v-validate="'required'" data-vv-as="地址"
                                        :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz1') }" >
                                    <option v-for="p in province" v-bind:value="p.code" v-html="p.name"></option>
                                </select>
                                <select class="address-select" name="quiz2" v-model="add.city" @change="tre_city(add,2)"
                                        :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz2') }">
                                    <option v-for="c in add.cityList" v-bind:value="c.code" v-html="c.name"></option>
                                </select>
                                <select v-show="selected_show" class="address-select" name="quiz3" v-model="add.country"
                                        :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz1') }">
                                    <option v-for="co in add.countryList" v-bind:value="co.code" v-html="co.name"></option>
                                </select>
                                <p class="red clear-both" v-show="errors.has('formA_'+add.id+'.quiz1')">${errors.first('formA_'+add.id+'.quiz1')}</p>
                                <div class="clear"></div>
                            </li>
                            <li>详细地址：
                                <input type="text" class="layui-input" v-model="add.recipientAddress" data-vv-as="详细地址" name="recipientAddress" v-validate="'required'"
                                       :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientAddress') }"/>
                                <p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientAddress')">${ errors.first('formA_'+add.id+'.recipientAddress') }
                                </p>
                            </li>
                        </ul>
                    </form>
                </div>
            </div>
            <div class="clear"></div>
            <div class="m-t" v-show="isMoreAdd">
                <div class="confimCont_moreInfo box_choice"  v-for="add in addressList" v-if="add.isDefault!=1"  :class="{'confim_checkClick':recipientId==add.id,'isEdit':add.isEdit}" @click="recipientId=add.id">
                    <div><img src="/img/confimCont_bg.png"/></div>
                    <div class="confimTop">
                        <h3>收件人信息</h3>
                        <!-- <p class="dis_p" v-if="add.isDefault!=1" @click.stop="deleteAddress(add)">删除</p>-->
                        <p class="confim_edit" data="true"><span class="edit_es" @click.stop="editAddress(add)">编辑</span>
                            <span class="save_es" @click.stop="saveAddress(add)">保存</span></p>
                        <!-- <p  class="dis_p"><label for="confim_Set" @click.stop="setIsDefault(add)">设为默认</label></p>-->
                    </div>
                    <div class="clear"></div>
                    <div class="confimEdit">
                        <form :data-vv-scope="'formA_'+add.id">
                            <ul class="edit_change" v-show="!add.isEdit">
                                <li>姓名：<span v-html="add.recipientName"></span></li>
                                <li>手机号码：<span v-html="add.recipientPhone"></span></li>
                                <li>地址：
                                    <span v-if="add.country" v-html="add.provinceDesc+add.cityDesc+add.countryDesc+add.recipientAddress"></span>
                                    <span v-if="!add.country" v-html="add.provinceDesc+add.cityDesc+add.recipientAddress"></span>
                                </li>
                            </ul>
                            <ul  v-show="add.isEdit">
                                <li>姓名：
                                    <input type="text" class="layui-input" v-model="add.recipientName" v-validate="'required'" data-vv-as="姓名"  name="recipientName" :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientName') }"/><p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientName')">${ errors.first('formA_'+add.id+'.recipientName') }</p>
                                </li>
                                <li>手机号码：
                                    <input type="text" class="layui-input" v-model="add.recipientPhone" data-vv-as="手机号码" name="recipientPhone" v-validate="'phone'"
                                           :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientPhone') }"/>
                                    <p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientPhone')">${ errors.first('formA_'+add.id+'.recipientPhone') }</p>
                                </li>
                                <li class="addressLi">
                                    <div>地址</div>
                                    <select class="address-select" name="quiz1" v-model="add.province"  @change="tre_city(add,1)"
                                            v-validate="'required'" data-vv-as="地址"
                                            :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz1') }" >
                                        <option v-for="p in province" v-bind:value="p.code" v-html="p.name"></option>
                                    </select>
                                    <select class="address-select" name="quiz2" v-model="add.city" @change="tre_city(add,2)"
                                            :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz2') }">
                                        <option v-for="c in add.cityList" v-bind:value="c.code" v-html="c.name"></option>
                                    </select>
                                    <select v-show="selected_show" class="address-select" name="quiz3" v-model="add.country"
                                            :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.quiz1') }">
                                        <option v-for="co in add.countryList" v-bind:value="co.code" v-html="co.name"></option>
                                    </select>
                                    <p class="red clear-both" v-show="errors.has('formA_'+add.id+'.quiz1')">${errors.first('formA_'+add.id+'.quiz1')}</p>
                                    <div class="clear"></div>
                                </li>
                                <li>详细地址：
                                    <input type="text" class="layui-input" v-model="add.recipientAddress" data-vv-as="详细地址" name="recipientAddress" v-validate="'required'"
                                           :class="{'input': true, 'is-danger': errors.has('formA_'+add.id+'.recipientAddress') }"/>
                                    <p class="help is-danger" v-show="errors.has('formA_'+add.id+'.recipientAddress')">${ errors.first('formA_'+add.id+'.recipientAddress') }
                                    </p>
                                </li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
            <div class="basicNoinfo" style="margin:0 auto; width: 115px; text-align:  center" v-if="addressList.length==0">
                <dl>
                    <dt><img src="/img/icon-emptystate.png" /></dt>
                    <dd>暂无地址！<a class="layui-btn add_reass" @click="addRess()">添加地址</a></dd>
                </dl>
            </div>
            <form id="dialog" @submit.prevent="validateForm('form-address-add')" data-vv-scope="form-address-add" class="hide">
                <div class="add-title-content" style="padding: 25px 25px">
                    <div class="layui-form-item">
                        <div class="form-div"><span>姓名：</span>
                            <input type="text" v-model="address.name" name="username" class="inputW"  v-validate="'required'" data-vv-as="姓名"
                                   :class="{'input': true, 'is-danger': errors.has('form-address-add.username') }"/>
                            <p class="red clear-both" v-show="errors.has('form-address-add.username')">${errors.first('form-address-add.username')}</p>
                        </div>
                        <div class="form-div"><span style="padding-left:0; ">手机号码：</span>
                            <input v-model="address.phone" name="phone" class="inputW"  v-validate="'required|phone'" data-vv-as="手机号码"
                                   :class="{'input': true, 'is-danger': errors.has('form-address-add.phone') }" />
                            <p class="red clear-both" v-show="errors.has('form-address-add.phone')">${errors.first('form-address-add.phone')}</p>
                        </div>
                        <div class="form-div addressLi">
                            <div>地址：</div>
                            <select class="address-select" name="quiz" v-model="address.selected_p"  @change="tre_add_city(2)"  v-validate="'required'" data-vv-as="地址"
                                    :class="{'input': true, 'is-danger': errors.has('form-address-add.quiz') }" >
                                <option v-for="p in province" v-bind:value="p.code" v-html="p.name"></option>
                            </select>
                            <select class="address-select" name="quiz2" v-model="address.selected_c" @change="tre_add_city(3)" v-validate="'required'" data-vv-as="地址"
                                    :class="{'input': true, 'is-danger': errors.has('form-address-add.quiz2') }">
                                <option v-for="c in city.data" v-bind:value="c.code" v-html="c.name"></option>
                            </select>
                            <select v-show="selected_show" class="address-select input" name="quiz3" v-model="address.selected_co">
                                <option v-for="co in country.data" v-bind:value="co.code" v-html="co.name"></option>
                            </select>
                            <div class='clear'></div>
                        </div>
                        <div class="form-div">
                            <span>详细地址：</span>
                            <input type="text" v-model="address.recipientAddress" name="recipientAddress1" class="inputW"  v-validate="'required'" data-vv-as="地址"
                                   :class="{'input': true, 'is-danger': errors.has('form-address-add.recipientAddress1') }" />
                        </div>
                        <p class="red clear-both" v-show="errors.has('form-address-add.recipientAddress1')">${errors.first('form-address-add.recipientAddress1')}</p>
                    </div>
                </div>
            </form>
            <div class="confimMore">
                <p v-if="addressListNotDefault.length>0" class="confimMore_Add" @click="isMoreAdd=!isMoreAdd">更多地址<span><img src="/img/confimMore.png"/> </span></p>
               <!-- <p id="add_reass" class="confim_addMore"><a class="layui-btn add_reass"  @click="addRess()" style="background: none;color:#4990e2">添加更多地址</a></p>-->
            </div>

        </div>
        <div class="confimTit">确认发票信息</div>
        <!--以前版本发票信息-->
        <!--<div class="confimInvoice">
            <div class="confimIsvoice">
                <ol>
                    <li>
                        <input type="radio" name="confimNo" value="0" id="no" class="confimNo" v-model="isBill">
                        <label for="no">不开发票</label>
                    </li>
                    <li class="confimYes">
                        <input type="radio" name="confimNo" value="1" id="yes" class="confimyes"  v-model="isBill">
                        <label for="yes">开发票</label>
                    </li>
                </ol>
                <div class="clear"></div>
                <div v-if="isBill==1">
                    <ul v-if="billTypeTemp == 0">
                        <li>发票类型：<span>增值税普通发票</span></li>
                        <li>发票抬头：<span v-html="billTextName"></span></li>
                    </ul>
                    <ul v-if="billTypeTemp == 1">
                        <li>发票类型：<span>增值税专用发票</span></li>
                        <li>发票抬头：<span v-html="billTextName"></span></li>
                    </ul>
                    <span  class="confim_bianji"><a class="layui-btn bill_open"  @click="showBillEdit()">编辑</a></span>
                </div>
            </div>
        </div>-->
        <!--以前版本发票信息-->


        <div class="confimContacts invoice_info">
            <div class="confimCont_left box_color_c box_choice" v-show="editInvoicShow"
                 :class="{'confim_checkClick':zgRecipientInfoId==userInvoicList.id}" @click="bodyClick(userInvoicList)">
                <div style="width: 600px;height: 8px;  background-color: #a6b6c4;"></div>
                <div class="confimTop">
                    <h3>发票信息</h3>
                    <!--<p class="dis_p" v-if="invoic.isDefault!=2" @click.stop="deleteInvoic(userInvoicList,1)">删除</p>-->
                    <p class="confim_edit">
                        <span class="edit_es" v-show="!userInvoicList.isEdit" @click.stop="editInvoic(userInvoicList,1)">编辑</span>
                        <!--<span v-show="userInvoicList.isEdit" @click.stop="saveEditInvoic(userInvoicList,1)">保存</span></p>-->
                </div>
                <!--清除浮动-->
                <div class="clear"></div>
                <div class="confimEdit">
                    <ul class="edit_change">
                        <li>发票抬头：<span v-show="userInvoicList.unitName" :title="userInvoicList.unitName">${userInvoicList.unitName}</span></li>
                        <li>纳税人识别号：<span v-show="userInvoicList.taxpayerNo" :title="userInvoicList.taxpayerNo">${userInvoicList.taxpayerNo}</span></li>
                        <li>注册地址：<span v-show="userInvoicList.registerAddress" :title="userInvoicList.registerAddress">${userInvoicList.registerAddress}</span></li>
                        <li>注册电话：<span v-show="userInvoicList.registerPhone" :title="userInvoicList.registerPhone">${userInvoicList.registerPhone}</span></li>
                        <li>开户银行：<span v-show="userInvoicList.openBank" :title="userInvoicList.openBank">${userInvoicList.openBank}</span></li>
                        <li>银行账号：<span v-show="userInvoicList.bankAcount" :title="userInvoicList.bankAcount">${userInvoicList.bankAcount}</span></li>
                    </ul>
                </div>
            </div>

            <div class="clear" style="margin-top:20px;"></div>

            <div class="m-t" v-show="isMoreInvoic">
                <div class="confimCont_left box_color_c box_choice"  v-for="invoic in invoiceList"
                     :class="{'confim_checkClick':zgRecipientInfoId==invoic.id}" @click="bodyClick(invoic)">
                    <div style="width: 600px;height: 8px;  background-color: #a6b6c4;"></div>
                    <div class="confimTop">
                        <h3>发票信息</h3>
                        <p @click.stop="deleteInvoic(invoic,2)">删除</p>
                        <p class="confim_edit">
                            <span class="edit_es" @click.stop="editInvoic(invoic,2)">编辑</span>
                            <!--<span v-show="invoic.isEdit" @click.stop="saveEditInvoic(invoic,2)">保存</span></p>-->
                    </div>
                    <!--清除浮动-->
                    <div class="clear"></div>
                    <div class="confimEdit">
                        <ul class="edit_change">
                            <li>发票抬头：<span :title="invoic.unitName">${invoic.unitName}</span></li>
                            <li>纳税人识别号：<span :title="invoic.taxpayerNo">${invoic.taxpayerNo}</span></li>
                            <li>注册地址：<span :title="invoic.registerAddress">${invoic.registerAddress}</span></li>
                            <li>注册电话：<span :title="invoic.registerPhone">${invoic.registerPhone}</span></li>
                            <li>开户银行：<span :title="invoic.openBank">${invoic.openBank}</span></li>
                            <li>银行账号：<span :title="invoic.bankAcount">${invoic.bankAcount}</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 暂无地址-->
            <div class="confimCont_left box_color_c box_choice" v-show="invoiceList.length==0 && !editInvoicShow">
                <div style="width: 600px;height: 8px;  background-color: #a6b6c4;"></div>
                <b style="display: block;font-weight: 600;font-size:18px;padding:5px;">暂无发票信息！</b>
                <a style="margin-left:25px;background-color:#b45245;color:#fff;margin-left:250px;margin-top:50px;" @click="addMoreInvoice()" class="layui-btn add_reass" >添加发票</a>
            </div>
            <div class="confimCont_left box_color_c box_choice" v-show="invoiceList.length!=0 && !editInvoicShow && !isMoreInvoic">
                <div style="width: 600px;height: 8px;  background-color: #a6b6c4;"></div>
                <b style="display: block;font-weight: 600;font-size:18px;padding:5px;">当前合同号下无发票信息！</b>
            </div>
            <!--添加更多-->
            <div class="clear"></div>
            <div class="confimMore">
                <p class="confimMore_Add" @click="isMoreInvoic = !isMoreInvoic">
                    选择发票<span><img src="/img/confimMore.png"/></span>
                </p>
               <!-- <p class="confim_addMore"><a class="layui-btn add_reass" @click="addMoreInvoice" style="background: none;color:#4990e2">添加更多发票</a></p>-->
            </div>
            <div class="clear"></div>
        </div>


        <div class="confimTit">选择支付方式</div>
        <div class="confimMode">
            <ol @click="btnShow=false">
                <li class="confimMode_li" v-if="!isPayType" :class="{'confimChecked':payType==1}" @click="payType=1">
                    <input type="radio" name="radio" value="1" class="radio" id="alipay" v-model="payType">
                    <label for="alipay">
                        <dl>
                            <dt><img src="/img/icon_payment_alipay.png"/></dt>
                            <dd>支付宝</dd>
                        </dl>
                    </label>
                </li>
                <li class="confimMode_li" v-if="!isPatent&&!isPayType" :class="{'confimChecked':payType==2}" @click="payType=2;weixinCode();">
                    <input type="radio" name="radio" value="2" class="radio" id="wechat" v-model="payType">
                    <label for="wechat">
                        <dl>
                            <dt><img src="/img/icon_payment_wechat.png"/></dt>
                            <dd>微信支付</dd>
                        </dl>
                    </label>
                </li>
                <li class="confimMode_li" v-if="!isPatent&&!isPayType" :class="{'confimChecked':payType==3}" @click="payType=3">
                    <input type="radio" name="radio" value="3" class="radio" id="bankcard" v-model="payType">
                    <label for="bankcard">
                        <dl class="confimBank">
                            <dt><img src="/img/icon_payment_bankcard.png"/></dt>
                            <dd>
                                <span>银行卡支付</span>
                                <span class="confimZc">支持在线对公转账</span>
                            </dd>
                        </dl>
                    </label>
                </li>
                <li class="confimMode_li" :class="{'confimChecked':payType==4}" @click="payType=4">
                    <input type="radio" name="radio" value="4" class="radio" id="transfer" v-model="payType">
                    <label for="transfer">
                        <dl>
                            <dt><img src="/img/icon_payment_transfer.png"/></dt>
                            <dd>转账汇款</dd>
                        </dl>
                    </label>
                </li>
                <li class="confimMode_li" v-if="money>0&&!isPayType" :class="{'confimChecked':payType==5}" @click="payType=5">
                    <input type="radio" name="radio" value="5" class="radio" id="payMon" v-model="payType">
                    <label for="payMon">
                        <dl>
                            <dd>余额支付</dd>
                        </dl>
                    </label>
                </li>
            </ol>
            <div class="clear"></div>
            <div class="confimTotal_con">
                <div v-if="payType==2">
                    <div class="confim_wechat">
                        <h4 v-html="'¥'+count"></h4>
                        <div class="confim_weImg" id="qrcode"></div>
                        <div class="confim_weSacn">
                            <b><img src="/img/icon_scan.png" style="width:32px;height:32px;"></b>
                            <b class="confim_weSpan">
                                <span>打开手机微信</span>
                                <span>扫一扫继续付款</span>
                            </b>
                        </div>
                    </div>
                </div>
                <div v-if="payType==3">
                    <dl class="clear payment-box">
                        <dd>
                            <ul class="payment-list clearfix">
                                <li>
                                    <div class="checkbox"  for="bank82">
                                        <label class="i-checks">
                                            <input type="radio" value="82" name="r2" v-model="bankCode" id="bank82">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_30.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank70">
                                        <label class="i-checks">
                                            <input type="radio" value="70" name="r2" v-model="bankCode" id="bank70">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_24.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank71">
                                        <label class="i-checks">
                                            <input type="radio" value="71" name="r2" v-model="bankCode" id="bank71">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_25.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank74">
                                        <label class="i-checks">
                                            <input type="radio" value="74" name="r2" v-model="bankCode" id="bank74">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_26.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank75">
                                        <label class="i-checks">
                                            <input type="radio" value="75" name="r2" v-model="bankCode" id="bank75">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_27.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank76">
                                        <label class="i-checks">
                                            <input type="radio" value="76" name="r2" v-model="bankCode" id="bank76">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_28.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank78">
                                        <label class="i-checks">
                                            <input type="radio" value="78" name="r2" v-model="bankCode" id="bank78">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_29.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"for="bank25">
                                        <label class="i-checks" >
                                            <input type="radio" value="25" name="r2" v-model="bankCode" id="bank25">
                                            <i></i>
                                        </label>
                                        <span><img src="/img/bank/s-yh-pic_1.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"for="bank29">
                                        <label class="i-checks" >
                                            <input type="radio" value="29" name="r2" v-model="bankCode" id="bank29">
                                            <i></i>
                                        </label>
                                        <span><img src="/img/bank/s-yh-pic_2.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"for="bank23">
                                        <label class="i-checks" >
                                            <input type="radio" value="23" name="r2" v-model="bankCode" id="bank23">
                                            <i></i>
                                        </label>
                                        <span><img src="/img/bank/s-yh-pic_3.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"for="bank19">
                                        <label class="i-checks" >
                                            <input type="radio" value="19" name="r2" v-model="bankCode" id="bank19">
                                            <i></i>
                                        </label>
                                        <span><img src="/img/bank/s-yh-pic_6.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"for="bank19">
                                        <label class="i-checks" >
                                            <input type="radio" value="27" name="r2" v-model="bankCode" id="bank27">
                                            <i></i>
                                        </label>
                                        <span><img src="/img/bank/s-yh-pic_8.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox" for="bank55">
                                        <label class="i-checks">
                                            <input type="radio" value="55" name="r2" v-model="bankCode" id="bank55">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_23.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox" for="bank21">
                                        <label class="i-checks">
                                            <input type="radio" value="21" name="r2" v-model="bankCode" id="bank21">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_4.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox" for="bank46">
                                        <label class="i-checks">
                                            <input type="radio" value="46" name="r2" v-model="bankCode" id="bank46">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_5.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox" for="bank45">
                                        <label class="i-checks">
                                            <input type="radio" value="45" name="r2" v-model="bankCode" id="bank45">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_9.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox" for="bank16">
                                        <label class="i-checks">
                                            <input type="radio" value="16" name="r2" v-model="bankCode" id="bank16">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_10.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank12">
                                        <label class="i-checks">
                                            <input type="radio" value="12" name="r2" v-model="bankCode" id="bank12">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_11.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank36">
                                        <label class="i-checks">
                                            <input type="radio" value="36" name="r2" v-model="bankCode" id="bank36">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_12.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank33">
                                        <label class="i-checks">
                                            <input type="radio" value="33" name="r2" v-model="bankCode" id="bank33">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_13.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank50">
                                        <label class="i-checks">
                                            <input type="radio" value="50" name="r2" v-model="bankCode" id="bank50">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_14.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank13">
                                        <label class="i-checks">
                                            <input type="radio" value="13" name="r2" v-model="bankCode" id="bank13">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_15.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank15">
                                        <label class="i-checks">
                                            <input type="radio" value="15" name="r2" v-model="bankCode" id="bank15">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_16.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank54">
                                        <label class="i-checks">
                                            <input type="radio" value="54" name="r2" v-model="bankCode" id="bank54">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_17.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank69">
                                        <label class="i-checks">
                                            <input type="radio" value="69" name="r2" v-model="bankCode" id="bank69">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_18.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank40">
                                        <label class="i-checks">
                                            <input type="radio" value="40" name="r2" v-model="bankCode" id="bank40">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_19.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank53">
                                        <label class="i-checks">
                                            <input type="radio" value="53" name="r2" v-model="bankCode" id="bank53">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_20.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank49">
                                        <label class="i-checks">
                                            <input type="radio" value="49" name="r2" v-model="bankCode" id="bank49">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_21.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank51">
                                        <label class="i-checks">
                                            <input type="radio" value="51" name="r2" v-model="bankCode" id="bank51">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_22.png" alt=""></span>
                                    </div>
                                </li>
                                <li>
                                    <div class="checkbox"  for="bank09">
                                        <label class="i-checks">
                                            <input type="radio" value="09" name="r2" v-model="bankCode" id="bank09">
                                            <i></i>
                                        </label>
                                               <span><img
                                                       src="/img/bank/s-yh-pic_7.png" alt=""></span>
                                    </div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                </div>
                <div v-if="payType==4" class="confimTotal_transfer">
                    <div class="confimtran_bank">
                        <dl>
                            <dt><img src="/img/bank.png"/></dt>
                            <dd v-if="!isPatent">
                                <p>银行账号：1109 1590 4910 206</p>
                                <p>开户行：招商银行北京分行海淀黄庄支行</p>
                                <p>账户名：北京知果科技有限公司</p>
                            </dd>
                            <dd v-if="isPatent">
                                <p>银行账号：1109 2162 6410 506</p>
                                <p>开户行：招商银行北京分行海淀黄庄支行</p>
                                <p>账户名：北京卓唐知识产权代理有限公司</p>
                            </dd>
                        </dl>
                    </div>
                    <div class="confimInput"><input type="text" v-model="trandCode" placeholder="请输入银行流水号"></div>
                </div>
                <div v-if="payType==5 && money>0">
                    <div>账号余额：<strong class="red" v-html="money.toFixed(2)"></strong></div>
                </div>
            </div>
        </div>
        <div class="cartAccountsBox">
            <div class="confimAccounts" id="accounts">
                <ul>
                    <li class="accountsBtn">
                        <div v-show="payType!==2">
                            <span class="order_btn1" v-if="!btnShow" @click="submitOrder()">提交订单</span>
                            <span v-if="btnShow" style="color: #f1f1f1">提交订单中</span>
                        </div>
                        <div v-show="payType==2">
                            <span style="color: #f1f1f1;">扫一扫支付</span>
                        </div>
                    </li>
                    <li class="accountsAll">合计：<span v-html="'¥'+count"></span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="hide" id="alipayBox">
        <form action="https://mapi.alipay.com/gateway.do?_input_charset=utf-8" id="alipayForm" method="get" target="_blank" >
            <input type="hidden" :value="alipay.partner" name="partner">
            <input type="hidden" :value="alipay.seller_id" name="seller_id">
            <input type="hidden" :value="alipay.out_trade_no" name="out_trade_no">
            <input type="hidden" :value="alipay.subject" name="subject">
            <input type="hidden" :value="alipay.body" name="body">
            <input type="hidden" :value="alipay.total_fee" name="total_fee">
            <input type="hidden" :value="alipay.notify_url" name="notify_url">
            <input type="hidden" :value="alipay.service" name="service">
            <input type="hidden" :value="alipay.payment_type" name="payment_type">
            <input type="hidden" :value="alipay._input_charset" name="_input_charset">
            <input type="hidden" :value="alipay.it_b_pay" name="it_b_pay">
            <input type="hidden" :value="alipay.return_url" name="return_url">
            <input type="hidden" :value="alipay.app_id" name="app_id">
            <input type="hidden" :value="alipay.sign" name="sign">
            <input type="hidden" :value="alipay.sign_type" name="sign_type">
        </form>
    </div>
    <div class="hide" id="hftx">
        <form name="payForm"  id='payForm' method="post" target="_blank" action="http://mas.chinapnr.com/gar/RecvMerchant.do" class="hide">
            <input type="hidden"  name="ChkValue"  v-model="hftxReq.chkValue">
            <input type="hidden"  name="Version"  v-model="hftxReq.version">
            <input type="hidden"  name="CmdId"  v-model="hftxReq.cmdId">
            <input type="hidden"  name="MerId" v-model="hftxReq.merId">
            <input type="hidden"  name="OrdId" v-model="hftxReq.ordId">
            <input type="hidden"  name="OrdAmt" v-model="hftxReq.ordAmt">
            <input type="hidden"  name="CurCode" v-model="hftxReq.curCode">
            <input type="hidden"  name="Pid" v-model="hftxReq.pid">
            <input type="hidden"  name="RetUrl" v-model="hftxReq.retUrl">
            <input type="hidden"  name="BgRetUrl" v-model="hftxReq.bgRetUrl">
            <input type="hidden"  name="MerPriv" v-model="hftxReq.merPriv">
            <input type="hidden"  name="GateId" v-model="hftxReq.gateId">
            <input type="hidden"  name="UsrMp" v-model="hftxReq.usrMp">
            <input type="hidden"  name="DivDetails" v-model="hftxReq.divDetails">
            <input type="hidden"  name="PayUsrId" v-model="hftxReq.payUsrId">
        </form>
    </div>
    <!--添加发票-->
    <form id="dialogInvoic" data-vv-scope="form-invoic-add" class="hide">
        <div class="add-title-content" style="padding: 25px 25px">
            <div class="layui-form-item">
                <div class="confim_boxNum"><span>*</span>发票抬头：
                    <input type="text" v-model="addInvoicData.unitName" name="username" class="inputW"  v-validate="'required'" data-vv-as="发票抬头"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.username') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-add.username')">${errors.first('form-invoic-add.username')}</p>
                </div>
                <div class="confim_boxNum"><span>*</span>纳税人识别号：
                    <input type="text" v-model="addInvoicData.taxpayerNo" name="taxpayerNum" class="inputW"  v-validate="'required|taxpayerNo'" data-vv-as="纳税人识别号"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.taxpayerNum') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-add.taxpayerNum')">${errors.first('form-invoic-add.taxpayerNum')}</p>
                </div>
                <div class="confim_boxNum">注册地址：
                    <input type="text" v-model="addInvoicData.registerAddress" name="zcAddress" class="inputW" data-vv-as="注册地址"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.zcAddress') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-add.zcAddress')">${errors.first('form-invoic-add.zcAddress')}</p>
                </div>
                <div class="confim_boxNum">注册电话：
                    <input type="text" class="inputW" v-model="addInvoicData.registerPhone" name="zcPhone" v-validate="'phone'" data-vv-as="注册电话"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.zcPhone') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-add.zcPhone')">${errors.first('form-invoic-add.zcPhone')}</p>
                </div>
                <div class="confim_boxNum">开户银行：
                    <input type="text" class="inputW" v-model="addInvoicData.openBank" name="openUserBank" data-vv-as="开户银行"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.openUserBank') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-add.openUserBank')">${errors.first('form-invoic-add.openUserBank')}</p>
                </div>
                <div class="confim_boxNum">银行账号：
                    <input type="text" class="inputW" v-model="addInvoicData.bankAcount" name="bankUserAcount" v-validate="'num'" data-vv-as="银行账户"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-add.bankUserAcount') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-add.bankUserAcount')">${errors.first('form-invoic-add.bankUserAcount')}</p>
                </div>
                <div class="confim_boxNum">一般纳税人证明：
                    <div class="upload_add_file">
                        <div id="item_sfz_addSfz" class="f_l" v-show="!addTaxpayerPath">
                            <a data-method="notice"  id="addSfz"></a>
                        </div>
                        <input type="hidden" class="hide" name="cateTaxpayerPath" v-model="addTaxpayerPath" data-vv-as="文件" class="inputW"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic-add.cateTaxpayerPath') }" >
                        <div class="pictureShow" v-show="addTaxpayerPath">
                            <img class="picture" :src="contractUrl+addTaxpayerPath" alt="" style="width:100px;height:100px;display: inline-block">
                            <img src="\img\icon_upload_delete.png" class="icon_delete" @click="addTaxpayerPath=''">
                        </div>
                    </div>
                    <p class="red clear-both" v-show="errors.has('form-invoic-add.cateTaxpayerPath')">${errors.first('form-invoic-add.cateTaxpayerPath')}</p>
                    <p class="order_addedIRS1" style="">一般纳税人证明可以企业对应省国税局网站查询截取如：<a target="_blank" href="/cooperation/addedIRS" style="color:rgb(35, 132, 204);display: block">${host}/cooperation/addedIRS</a></p>
                    <span style="color:#000">请上传一般纳税人证明</span>
                </div>
            </div>
        </div>
    </form>
    <form id="editDefaultInvoic" data-vv-scope="form-invoic-edit" class="hide">
        <div class="add-title-content" style="padding: 25px 25px">
            <div class="layui-form-item">
                <div class="confim_boxNum"><span>*</span>发票抬头：
                    <input type="text" v-model="editDefaultInvoic.unitName" name="username" class="inputW"  v-validate="'required'" data-vv-as="发票抬头"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.username') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-edit.username')">${errors.first('form-invoic-edit.username')}</p>
                </div>
                <div class="confim_boxNum"><span>*</span>纳税人识别号：
                    <input type="text" v-model="editDefaultInvoic.taxpayerNo" name="taxpayerNum" class="inputW"  v-validate="'required|taxpayerNo'" data-vv-as="纳税人识别号"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.taxpayerNum') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-edit.taxpayerNum')">${errors.first('form-invoic-edit.taxpayerNum')}</p>
                </div>
                <div class="confim_boxNum">注册地址：
                    <input type="text" v-model="editDefaultInvoic.registerAddress" name="zcAddress" class="inputW" data-vv-as="注册地址"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.zcAddress') }"/>
                    <p class="red clear-both" v-show="errors.has('form-invoic-edit.zcAddress')">${errors.first('form-invoic-edit.zcAddress')}</p>
                </div>
                <div class="confim_boxNum">注册电话：
                    <input type="text" class="inputW" v-model="editDefaultInvoic.registerPhone" name="zcPhone" v-validate="'phone'" data-vv-as="注册电话"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.zcPhone') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-edit.zcPhone')">${errors.first('form-invoic-edit.zcPhone')}</p>
                </div>
                <div class="confim_boxNum">开户银行：
                    <input type="text" class="inputW" v-model="editDefaultInvoic.openBank" name="openUserBank" data-vv-as="开户银行"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.openUserBank') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-edit.openUserBank')">${errors.first('form-invoic-edit.openUserBank')}</p>
                </div>
                <div class="confim_boxNum">银行账号：
                    <input type="text" class="inputW" v-model="editDefaultInvoic.bankAcount" name="bankUserAcount" v-validate="'num'" data-vv-as="银行账户"
                           :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.bankUserAcount') }"/>
                    <p class="help is-danger" v-show="errors.has('form-invoic-edit.bankUserAcount')">${errors.first('form-invoic-edit.bankUserAcount')}</p>
                </div>
                <div class="confim_boxNum">一般纳税人证明：
                    <div class="upload_add_file">
                        <div id="item_edit_invoic" class="f_l" v-show="!editDefaultInvoic.taxpayerPath">
                            <a data-method="notice"  id="item_edit"></a>
                        </div>
                        <input type="hidden" class="hide" name="cateTaxpayerPath" v-model="editTaxpayerPath" data-vv-as="文件" class="inputW"
                               :class="{'input': true, 'is-danger': errors.has('form-invoic-edit.cateTaxpayerPath') }" >
                        <div class="pictureShow" v-show="editDefaultInvoic.taxpayerPath">
                            <img class="picture" :src="editTaxpayerPath" alt="" style="width:100px;height:100px;display: inline-block">
                            <img src="\img\icon_upload_delete.png" class="icon_delete" @click="editDefaultInvoic.taxpayerPath='';editTaxpayerPath=''">
                        </div>
                    </div>
                    <p class="red clear-both" v-show="errors.has('form-invoic-edit.cateTaxpayerPath')">${errors.first('form-invoic-edit.cateTaxpayerPath')}</p>
                    <p class="order_addedIRS" >一般纳税人证明可以企业对应省国税局网站查询截取如：<a target="_blank" href="/cooperation/addedIRS" style="color:rgb(35, 132, 204);display: block">${host}/cooperation/addedIRS</a></p>
                    <span style="color:#000">请上传一般纳税人证明</span>
                </div>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="/js/confimProduct.js"></script>
<script type="text/javascript" src="/js/getCookies.js"></script>
<script type="text/javascript">
    //获取cookies信息追加到地址栏
    var user1 = JSON.parse(getCookie('_zg_user'));
    var isPayType = false;
    {{#session}}
    {{#JSONparse user}}
    {{#if payType}}
    isPayType = true;
    {{/if}}
    {{/JSONparse}}
    {{/session}}
    var phone = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的手机号码';
            }
        },
        validate: function validate(value, args) {
            return ((/^(1[3-9][0-9]{9})$/.test(value))|| (/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/).test(value));
            //return ((/^(1[3-9][0-9]{9})$/.test(value)));
        }
    };
    var num = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的银行账号！';
            }
        },
        validate: function validate(value, args) {
            return ((/\d+/.test(value)));
        }
    };
    var taxpayerNo = {
        messages: {
            en: function en(field, args) {
                return args + '纳税人识别必须是15-20字符';
            }
        },
        validate: function validate(value, args) {
            return (/^[A-Za-z0-9]{15,20}$/.test(value));
        }
    };
    var tel = {
        messages: {
            en: function en(field, args) {
                return args + '请输入正确的手机号码';
            }
        },
        validate: function validate(value, args) {
           // return ((/^(1[3-9][0-9]{9})$/.test(value))|| (/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/).test(value));
            return ((/^(1[3-9][0-9]{9})$/.test(value)));
        }
    };
    VeeValidate.Validator.extend('tel', tel);
    VeeValidate.Validator.extend('num', num);
    VeeValidate.Validator.extend('phone', phone);
    VeeValidate.Validator.extend('taxpayerNo', taxpayerNo);
    var pData = {{{ pData }}},
    couponList = {{{ couponList }}} || null,
    userInvoicList = {{{invoicData}}},
    user =   {{{moneyData}}},
    addressData = {{{ addressList}}};
    if(pData.zgOrders === undefined){
        alert('当前合同已删除！');
        window.close();
    }
    var orderVM = new Vue({
        el:"#order",
        delimiters: ['${', '}'],
        data:{
            addInvoicData:{
                unitName:"",
                taxpayerNo:"",
                registerAddress:"",
                registerPhone:"",
                openBank:"",
                bankAcount:"",
                taxpayerPath:""
            },
            editDefaultInvoic:{},
            userInvoicList:userInvoicList, //订单下的合同发票信息
            invoicData:{},
            editInvoicData:{},
            addTaxpayerPath:'',//上传纳税人证明
            editTaxpayerPath:'',
            editMoreTaxpayerPath:'',
            isPayType:isPayType,
            isEditInvoicMore:false,
            isEditInvoic:false,
            moreList:false,
            money:typeof user.money != 'undefined'?user.money:0,
            confimProduct:pData.zgOrders,
            ImgUrl:zgg.Vconfig.ImgUrl,
            contractUrl:zgg.Vconfig.contractUrl,
            minItemNum:0,
            contractcode:pData.contractcode,
            payType:1,
            alipay:{
            },
            addressList:addressData,
            moreInvoiceList:'',//更多发票数据
            invoiceList: {},//初始化发票信息
            couponList: couponList, //初始化数组
            bankCode:"",  //银行卡CODE；
            isBill:pData.openbill,//是否开票 0 不开 1开
            billName:"",//发票抬头
            billType:0, //发票类型 0普通发票,1增值发票
            hftxReq:{},
            billTextName:"",//抬头文字显示
            billTypeName:"增值税普通发票",
            billTypeTemp:0,//临时存储类型
            zgVatInfo:pData.zgVatInfo, //增值发票对象
            isShowCoupon:false, //默认不显示优惠券项
            couponId:-1,
            times:60, //微信查询次数
            isPatent:"",//是否是专利产品 专利涉及的支付方式显示 (不显示 微信   银行卡  线下支付显示:卓唐(南京)账号)
            account:0,//商品合计
            selectCouponItem:0,//优惠券初始化
            trandCode:"",//银行流水初始化
            province:[], //地区联动
            selected_p:[],
            province:[],
            city:{data:[]},
            selected_c:[],
            country:{data:[]},
            selected_co:[],
            selected_show:false,
            btnShow:false,
            isMoreAdd:false, //显示更多地址
            isMoreInvoic:false,//显示更多发票
            recipientId:0,
            zgRecipientInfoId:'',
            txtType:['jpg','png','jpeg'],
            address:{},
            addId : '',
            editInvoicShow:false,
            host:window.location.host,
        },
        created:function(){
            var newPtList = $.grep(this.confimProduct,function (item) {
                return item.pcode.indexOf('pt')>=0;
            })[0]
            var account=0
            this.confimProduct.forEach(function (item) {
                account += (item.money*1);
            })
            if(this.addressList.length > 0){
                var addressDefualt = $.grep(this.addressList,function (item) {
                    return item.isDefault==1;
                })[0]
                this.recipientId = addressDefualt.id
            }
            this.account = account.toFixed(2);
            this.isPatent = (typeof newPtList != 'undefined');
            this.getRegion();
            this.initInvoicList();
            if(Object.keys(pData.zgVatInfo).length > 0){
                this.billTextName = pData.zgVatInfo.unitName;
            }else if(pData.billname){
                this.billTextName = pData.billname;
                this.billName = pData.billname;
            }
            if(this.userInvoicList.hasOwnProperty('id')){
                this.editInvoicShow = true;
                //this.zgRecipientInfoId = this.userInvoicList.id;
            }
        },
        mounted:function(){
            this.updataFile('#addSfz', 'item_sfz_addSfz', 'addTaxpayerPath'); //添加纳税人证明
            this.updataFile('#item_edit', 'item_edit_invoic', 'editTaxpayerPath'); //编辑纳税人证明
            //this.updataFile('#editInvoicMore', 'item_edit_more', 'editMoreTaxpayerPath'); //编辑更多地址纳税人证明
        },
        beforeCreate:function(){
           // this.updataFile('#editInvoic', 'item_edit_invoic', 'editTaxpayerPath'); //编辑纳税人证明
            $('#editInvoic').uploadifive({
                'auto' : true,
                'queueID' : 'item_edit_invoic',
                'checkScript':'/upload/check',
                'uploadScript' : '/upload/profile',
                'buttonCursor':'hand',
                'buttonText':'',
                "buttonClass":"addFile",
                'width': 90,
                'method' : 'post',
                'fileSizeLimit ': 1024 * 1024 * 2,
                'fileType': '*.jpg;*.jpeg;*.png;',
                'progressData':'percentage',
                'formData':{
                    'fType':"ft_8"
                },
                'onDrop':function(file, fileDropCount) {
                    debugger;
                },
                'onUploadComplete' : function(file, data, response) {
                    if(imgUrl == 'addTaxpayerPath'){
                        orderVM.addInvoicData.taxpayerPath = JSON.parse(data).data.filePath;
                        orderVM.addTaxpayerPath = orderVM.addInvoicData.taxpayerPath
                    }
                    layer.msg('上传成功',{icon:1});
                },
                'onCheck'  : function(file, exists) {
                    if (orderVM.txtType.indexOf(file.name.split(".")[file.name.split(".").length - 1].toLowerCase()) == -1) {
                        layer.msg("请上传jpg,png,jpeg格式图片！");
                        $(_str).uploadifive('cancel', file)
                    }
                },
                'onError' : function (file, data, response) {
                    debugger;
                }
            })
        },
        computed:{
            count:function () {
                return this.account;
            },
            convertCouponList: function () {
                var self = this
                return self.couponList.filter(function (user) {
                    return user.ustat == "T"
                })
            },
            addressListNotDefault:function () {
                return this.addressList.filter(function (add) {
                    return add.isDefault != 1;
                })
            }
        },
        watch: {
            /*isBill:{
                handler:function (newValue, oldValue) {
                    if(newValue==1){
                        bill_open();
                    }
                }
            },*/
            billType:{
                handler:function (newValue, oldValue) {
                    /*if(newValue==1){
                     }
                     if(newValue==2){
                     }*/
                }
            },
            couponId:{
                handler:function(newValue,oldValue){
                    if(newValue){
                        this.selectCouponItem = $.grep(this.couponList,function (item) {
                            return item.id == newValue;
                        })[0]['accountCont']
                    }
                }
            },
            /*userInvoicList:{
                handler: function (newValue, oldValue){
                    this.updataFile('#editInvoic', 'item_edit_invoic', 'editTaxpayerPath'); //编辑纳税人证明
                }
            }*/
        },
        methods:{
            //新增地址
            addRess:function(){
                orderVM.errors.clear('form-address-add');
                orderVM.address ={};
                var layer_type = {
                    type: 1,
                    title: "新增地址",//false不显示标题栏,
                    // closeBtn: false,是否显示头部删除按钮
                    offset: '100px',
                    area: '480px;',
                    shade: 0.6,
                    id: 'LAY_layuipro_address' ,//设定一个id，防止重复弹出,
                    btn: ['取消', '保存为默认地址'],
                    moveType: 1 ,//拖拽模式，0或者1,
                    content: $("#dialog"),
                    success: function (layero) {
                        //弹框加载成功
                    },
                    yes:function () {
                        //点击取消事件
                        layer.close(addressOpenDialog);
                    },
                    btn2:function () {
                        orderVM.$validator.validateAll('form-address-add').then(function (result) {
                            if(result){
                                var selected_pName='',selected_cName='',selected_coName='';
                                orderVM.province.map(function (item) {
                                    if(item.code==orderVM.address.selected_p){
                                        selected_pName=item.name
                                    }
                                });
                                orderVM.city.data.map(function (item) {
                                    if(item.code==orderVM.address.selected_c){
                                        selected_cName=item.name
                                    }
                                });
                                if(orderVM.country.data.length !=0 ){
                                    orderVM.country.data.map(function (item) {
                                        if(item.code==orderVM.address.selected_co){
                                            selected_coName=item.name
                                        }
                                    });
                                }
                                var _data={
                                    recipientName:orderVM.address.name,
                                    recipientPhone:orderVM.address.phone,
                                    province:orderVM.address.selected_p,
                                    provinceDesc:selected_pName,
                                    city:orderVM.address.selected_c,
                                    cityDesc:selected_cName,
                                    recipientAddress:orderVM.address.recipientAddress,
                                    isDefault:1,
                                    status:0,
                                };
                                if(orderVM.country.data.length !=0){
                                    _data.country=orderVM.address.selected_co;
                                    _data.countryDesc=selected_coName;
                                }
                                $.ajax({
                                    url:'/userCenter/addAddressList',
                                    type:'post',
                                    data:_data,
                                    success: function(_data) {
                                        if(_data.success) {
                                            orderVM.addressList.map(function (item) {
                                                item.isDefault = 0;
                                            })
                                            orderVM.addressList.push(_data.data);
                                            //将默认设置致空
                                            orderVM.recipientId = _data.data.id
                                            layer.closeAll();
                                        }
                                    }
                                })
                            }
                        });
                        return false;
                    }
                }
                layui.use('layer',function() {
                    addressOpenDialog = layer.open(layer_type);
                })

            },
            tre_add_city:function (num) {
                var that = this;
                if(num==2){
                    that.province.map(function (item) {
                        if(item.code == that.address.selected_p){
                            that.$set(that.city,'data',item.sub);
                        }
                    });
                    that.$set(that.address.country,'data',[]);
                    that.selected_show=true;
                }else if(num==3){
                    that.city.data.map(function (item) {
                        if(item.code == that.address.selected_c){
                            that.$set(that.country,'data',item.sub);
                            that.selected_show=true;
                            if(item.sub.length==0){
                                that.selected_show=false;
                            }
                        }
                    });
                }
//                    if(that.selected_show&&this.address.selected_co){
//                        this.add_ress = true;
//                    }else if(address.selected_c){
//                        this.add_ress = true;
//                    }

            },
            editAddress:function (add) {
                Vue.set(add,'isEdit',true);
                this.tre_city(add,1);
            },
            selectAddress:function(add){
                this.recipientId=add.id
                this.addressList.forEach(function(item){
                    item.isEdit = false;
                })

            },
            saveAddress:function (add) {
                //先校验
                this.$validator.validateAll("formA_"+add.id).then(function(result) {
                    if (result) {
                        var _data={
                            recipientName:add.recipientName,
                            recipientPhone:add.recipientPhone,
                            province:add.province,
                            provinceDesc:add.provinceDesc,
                            city:add.city,
                            cityDesc:add.cityDesc,
                            recipientAddress:add.recipientAddress,
                            id:add.id
                        };
                        if(add.countryList.length>0){
                            _data.country = add.country;
                            add.countryList.map(function (item) {
                                if(item.code == add.country){
                                    _data.countryDesc =  add.countryDesc =item.name;
                                }
                            })
                        }else{
                            add.countryDesc = "";
                        }
                        axios.post('/userCenter/editAddressList',_data).then(
                                function (res) {
                                    if(res.data.success){
                                        layui.use('layer',function() {
                                            layer.msg("修改成功！！！",{icon:1});
                                            add.isEdit = false;
                                        })
                                    }
                                },
                                function(err){
                                    console.log(err);
                                }
                        )
                    }
                });
                return;
            },
            deleteAddress:function(add){
                layui.use('layer',function() {
                    layer.confirm('你确定删除该地址信息？', {
                        btn: ['取消','确定'] //按钮
                    }, function(){
                        layer.closeAll();
                    }, function(){
                        axios.post('/userCenter/delAddressList',{id:add.id,status:1}).then(
                                function (res) {
                                    if(res.data.success){
                                        orderVM.addressList.forEach(function(item,key){
                                            if(item.id == add.id){
                                                orderVM.addressList.splice(key,1);
                                            }
                                        })
                                    }
                                },
                                function(err){
                                    console.log(err);
                                }
                        )
                    });
                })
            },
            //

            //发票点击所有选中
            bodyClick:function (invoic){
                orderVM.zgRecipientInfoId = invoic.id;
                orderVM.isBill = 1;  //选中发票信息之后
                orderVM.invoicData = invoic;
            },
            //发票信息列表
            initInvoicList:function () {  //查询默认使用数据
                axios.post('/userCenter/getZgUserBillInfoList/',{mode:1}).then(function (res) {
                    if(res.data.success && res.data.data){
                        orderVM.invoiceList = res.data.data;
                        orderVM.invoiceList.map(function(item,index){
                            if(orderVM.userInvoicList.id == item.id){
                                delete orderVM.invoiceList[index];
                            }
                            orderVM.moreList = item.isDefault == 2 ? true : false;
                        })
                    }
                })
            },
            //添加发票
            addMoreInvoice:function(){
                orderVM.errors.clear('form-invoic-add');
                var layer_type = {
                    type: 1,
                    title: "添加发票信息",//false不显示标题栏,
                    // closeBtn: false,是否显示头部删除按钮
                    offset: '50px',
                    area: '500px;',
                    closeBtn: 1,
                    shade: 0.6,
                    id: 'LAY_layuipro_addInvoic' ,//设定一个id，防止重复弹出,
                    btn: ['取消', '保存'],
                    moveType: 1 ,//拖拽模式，0或者1,
                    content: $("#dialogInvoic"),
                    success: function (layero) {
                        //弹框加载成功
                    },
                    yes:function () {
                        //点击取消事件
                        layer.close(invoicOpenDialog);
                        orderVM.addTaxpayerPath = '';
                        orderVM.addInvoicData = {};
                    },
                    btn2:function () {
                        orderVM.$validator.validateAll('form-invoic-add').then(function (result) {
                            if(result){
                                $.ajax({
                                    url:'/userCenter/saveZgUserBillInfo',
                                    type:'post',
                                    data:orderVM.addInvoicData,
                                    success: function(_data) {
                                        if(_data.success) {
                                            orderVM.initInvoicList();
                                            layer.close(invoicOpenDialog);
                                            orderVM.addInvoicData = {};
                                            orderVM.addTaxpayerPath = '';
                                            layer.msg(_data.message,{icon:1});
                                            /*layui.use('layer',function() {
                                                layer.confirm('是否把当前信息设为默认？', {
                                                    btn: ['取消','确定'] //按钮
                                                }, function(){
                                                    layer.closeAll();
                                                    orderVM.initInvoicList();
                                                }, function(){
                                                    axios.put('/userCenter/updateZgUserBillInfoIsDefaultById',{id:_data.data.id}).then(function (res) {
                                                         if(res.data.success){
                                                             orderVM.initInvoicList();
                                                             layer.msg('设置默认成功！',{icon:2})
                                                             layer.closeAll();
                                                         }
                                                     }, function(err){
                                                            console.log(err);
                                                     })
                                                });
                                            })*/
                                        }else{
                                            layer.msg(_data.message,{icon:2})
                                        }
                                    }
                                })
                            }
                        });
                        return false;
                    }
                };
                layui.use('layer',function() {
                    invoicOpenDialog = layer.open(layer_type);
                })
            },
            //编辑发票
            editInvoic:function(data,type){
                //截取地址栏里面的orderId
                var reg = /\/\d{6}$/;
                var id = window.location.href.match(reg).toString().substr(1);
                var layer_type = {
                    type: 1,
                    title: "编辑发票信息",//false不显示标题栏,
                    // closeBtn: false,是否显示头部删除按钮
                    offset: '50px',
                    area: '500px;',
                    closeBtn: 1,
                    shade: 0.6,
                    id: 'LAY_layuipro_addInvoic' ,//设定一个id，防止重复弹出,
                    btn: ['保存', '取消'],
                    moveType: 1 ,//拖拽模式，0或者1,
                    content: $("#editDefaultInvoic"),
                    success: function (layero) {
                        //弹框加载成功
                        if(type == 1){
                            axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:id}).then(function(res){
                                if(res.data.success && res.data.data){
                                    orderVM.editDefaultInvoic = res.data.data;
                                    orderVM.editTaxpayerPath = orderVM.editDefaultInvoic.taxpayerPath;
                                }
                            })
                        }else if(type == 2){
                            axios.post('/userCenter/getZgUserBillInfoListById/' ,{id:data.id} ).then(function (res) {
                                if(res.data.success && res.data.data){
                                    orderVM.editDefaultInvoic = res.data.data[0];
                                    orderVM.editTaxpayerPath = orderVM.editDefaultInvoic.taxpayerPath;
                                }
                            })
                        }
                    },
                    btn2:function () {
                        //点击取消事件
                        layer.close(editInvoicOpenDialog);
                        if(type == 1){
                            orderVM.editDefaultInvoic = orderVM.userInvoicList;
                        }
                        orderVM.editDefaultInvoicData = {};
                    },
                    yes:function () {

                        orderVM.$validator.validateAll('form-invoic-edit').then(function (result) {
                            if(orderVM.editDefaultInvoic.taxpayerPath){
                                orderVM.editDefaultInvoic.taxpayerPath = '/base' + orderVM.editDefaultInvoic.taxpayerPath.split('/base')[1];
                            }
                            orderVM.invoicData = orderVM.editDefaultInvoic
                            if(type == 1){
                                axios.put('/userCenter/updateZgVatInfo/',orderVM.editDefaultInvoic).then(function (res) {
                                    if(res.data.success){
                                        axios.post('/userCenter/findBillInfOfOrderDetailsByOrderId',{orderId:id}).then(function(res){
                                            if(res.data.success && res.data.data){
                                                orderVM.userInvoicList = res.data.data;
                                                orderVM.editTaxpayerPath = orderVM.editDefaultInvoic.taxpayerPath;
                                                orderVM.invoicData = orderVM.userInvoicList;
                                            }
                                        })
                                        layer.close(editInvoicOpenDialog);
                                        orderVM.initInvoicList();
                                        layui.use('layer',function() {
                                            layer.msg("修改成功！！！",{icon:1});
                                        })
                                    }else{
                                        layui.use('layer',function() {
                                            layer.msg(res.data.message,{icon:2});
                                        });
                                    }
                                })
                            }else if(type == 2){
                                axios.put('/userCenter/updateZgUserBillInfo/',orderVM.editDefaultInvoic).then(function (res) {
                                    if(res.data.success){
                                        layer.close(editInvoicOpenDialog);
                                        orderVM.initInvoicList();
                                        layui.use('layer',function() {
                                            layer.msg("修改成功！！！",{icon:1});
                                        })
                                    }else{
                                        layui.use('layer',function() {
                                            layer.msg(res.data.message,{icon:2});
                                        });
                                    }
                                })
                            }
                        });
                        return false;
                    }
                };
                layui.use('layer',function() {
                    editInvoicOpenDialog = layer.open(layer_type);
                })
            },
            //发票编辑之后的保存
            /*saveEditInvoic:function (data,type) {
                if(type == 1 && !data.hasOwnProperty('registerAddress')){
                    delete data.zgYjBillOfContractVo;
                    delete data.contractCode;
                    delete data.billType;
                    delete data.billStatus;
                    delete data.recipientId;
                    data.isDefault = 1;
                    data.registerAddress = '';
                    data.registerPhone = '';
                    data.taxpayerNo = '';
                    data.taxpayerPath = '';
                    data.unitName = '';
                    data.openBank = '';
                    data.bankAcount = '';
                }
                axios.put('/userCenter/updateZgUserBillInfo/',data).then(function (res) {
                    if(res.data.success){
                        data.isEdit = !data.isEdit;
                        layui.use('layer',function() {
                            layer.msg("修改成功！！！",{icon:1});
                        })
                    }else{
                        layui.use('layer',function() {
                            layer.msg(res.data.message,{icon:2});
                        });
                    }
                })
            },*/
            //删除发票
            deleteInvoic:function (data,type) {
                $.ajax({
                    url:'/userCenter/deleteZgUserBillInfoById',
                    type:'post',
                    data:{id:data.id},
                    success: function(_data) {
                        if (_data.success) {
                            orderVM.initInvoicList();
                            layui.use('layer',function() {
                                layer.msg("删除成功！！！",{icon:1});
                            })
                        }else{
                            layui.use('layer',function() {
                                layer.msg(_data.data.message,{icon:2});
                            })
                        }
                    }
                });
            },
            //上传图片
            updataFile:function (_str,queId,imgUrl,other) {
                if(navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion .split(";")[1].replace(/[ ]/g,"")=="MSIE9.0") {
                    var _fileSizeLimit =  '2MB', _fileTypeExts = '*.jpg;*.bmp;*.jpeg;*.png;*.gif;';
                    if(_oth === 'other' ){
                        _fileSizeLimit =  '100MB';
                        _fileTypeExts = '*.jpg;*.gif;*.png;*.bmp;*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.pdf;*.txt;*.rar;*.zip';
                    }
                    $(_str).uploadify({
                        'auto' : true,
                        'queueID' : queId,
                        'checkScript':'/upload/check',
                        'uploadScript' : '/upload/profile',
                        'buttonCursor':'hand',
                        'buttonText':'',
                        "buttonClass":"addFile",
                        'width': 90,
                        'method' : 'post',
                        'fileSizeLimit ': 1024 * 1024 * 2,
                        'fileType': '*.jpg;*.jpeg;*.png;',
                        'progressData':'percentage',
                        'formData':{
                            'fType':"ft_8"
                        },
                        'onDrop':function(file, fileDropCount) {
                            debugger;
                        },
                        'onFallback':function () {
                            alert('请安装或升级更高版本的Flash插件');
                        },
                        'onUploadComplete' : function(file, data, response) {
                            if(imgUrl == 'addTaxpayerPath'){
                                orderVM.addInvoicData.taxpayerPath = JSON.parse(data).data.filePath;
                                orderVM.addTaxpayerPath = orderVM.addInvoicData.taxpayerPath
                            }else if(imgUrl == 'editTaxpayerPath'){
                                orderVM.editDefaultInvoic.taxpayerPath = orderVM.contractUrl + JSON.parse(data).data.filePath;
                                orderVM.editTaxpayerPath = orderVM.editDefaultInvoic.taxpayerPath;
                            }
                            layer.msg('上传成功',{icon:1});
                        },
                        'onCheck'  : function(file, exists) {
                            if (orderVM.txtType.indexOf(file.name.split(".")[file.name.split(".").length - 1]) == -1) {
                                layer.msg("请上传jpg,png,jpeg,pdf格式图片！");
                                $(_str).uploadifive('cancel', file)
                            }
                        },
                        'onError' : function (file, data, response) {
                            debugger;
                        }
                    })
                }else{
                    $(_str).uploadifive({
                        'auto' : true,
                        'queueID' : queId,
                        'checkScript':'/upload/check',
                        'uploadScript' : '/upload/profile',
                        'buttonCursor':'hand',
                        'buttonText':'',
                        "buttonClass":"addFile",
                        'width': 90,
                        'method' : 'post',
                        'fileSizeLimit ': 1024 * 1024 * 2,
                        'fileType': '*.jpg;*.jpeg;*.png;',
                        'progressData':'percentage',
                        'formData':{
                            'fType':"ft_8"
                        },
                        'onDrop':function(file, fileDropCount) {
                            debugger;
                        },
                        'onUploadComplete' : function(file, data, response) {
                            if(imgUrl == 'addTaxpayerPath'){
                                orderVM.addInvoicData.taxpayerPath = JSON.parse(data).data.filePath;
                                orderVM.addTaxpayerPath = orderVM.addInvoicData.taxpayerPath
                            }else if(imgUrl == 'editTaxpayerPath'){
                                orderVM.editDefaultInvoic.taxpayerPath = orderVM.contractUrl +JSON.parse(data).data.filePath;
                                orderVM.editTaxpayerPath = orderVM.editDefaultInvoic.taxpayerPath;
                            }
                            layer.msg('上传成功',{icon:1});
                        },
                        'onCheck'  : function(file, exists) {
                            if (orderVM.txtType.indexOf(file.name.split(".")[file.name.split(".").length - 1].toLowerCase()) == -1) {
                                layer.msg("请上传jpg,png,jpeg格式图片！");
                                $(_str).uploadifive('cancel', file)
                            }
                        },
                        'onError' : function (file, data, response) {
                            debugger;
                        }
                    })
                }
            },


            //
            //编辑开发票
            showBillEdit:function () {
                bill_open();
            },
            //显示优惠券
            showCoupon:function () {
                //获取优惠券列表
                this.getPcodeToCoupon();
            },
            //创建微信二维码
            weixinCode:function () {
                this.submitOrder();
            },
            //修改合同号
            submitOrder:function () {
                //cookies用户信息校验
                var user = JSON.parse(getCookie('_zg_user'));
                if(user.id != user1.id){
                    layui.use('layer',function(){
                        layer.open({
                            title:'提示',
                            content:'<p style="text-align: center;">该订单不属于此用户</p>',
                            btn: false
                        });
                    });
                    return;
                }
                if(this.recipientId ==0){
                    layui.use('layer',function(){
                        layer.msg('请先设置收货地址', {
                            icon: 5,
                            maxWidth:220,
                            time: 3*1000 //6s后自动消失
                        })})
                    return;
                }

                //转账汇款合同号必输
                if(parseInt(orderVM.payType) == 4){
                    if(orderVM.trandCode == ""&&!orderVM.isPayType){
                        layui.use('layer',function() {
                            layer.msg('请输入银行流水号',{
                                icon: 5,
                                maxWidth:220,
                                time: 3*1000 //6s后自动消失
                            });
                        })
                        return;
                    }
                }
                //余额支付金额大于订单金额
                if(parseInt(orderVM.payType) == 5){
                    if(parseInt(orderVM.money) < parseInt(orderVM.count) ){
                        layui.use('layer',function() {
                            layer.msg('余额不足!',{
                                icon: 5,
                                maxWidth:220,
                                time: 3*1000 //6s后自动消失
                            });
                        })
                        return;
                    }
                }
                //银行支付流程
                if(parseInt(orderVM.payType) == 3){
                    if(orderVM.bankCode == "" ){
                        layui.use('layer',function() {
                            layer.msg('请选择付款银行！！',{
                                icon: 5,
                                maxWidth:220,
                                time: 3*1000 //6s后自动消失
                            });
                        })
                        return;
                    }
                }
                //判断当前订单是否删除（数据同步）
                axios.post('/order/getPayInfoByContractCode/',{contractCode:pData.contractcode}).then(function (res) {
                    if(res.data.success) {
                        orderVM.reModify();
                    }else{
                        layui.use('layer',function() {
                            layer.msg(_data.data.message,{icon:2});
                        })
                    }
                })
            },
            //重新修改订单信息
            reModify:function(){
                axios.post('/order/updateOrderPayInfo',this.convertProData()).then(function (res) {
                    if(res.data && res.data.success){
                        orderVM.payOrder(orderVM.payType);
                        orderVM.btnShow = true;
                    }
                })
            },


            payOrder:function (payType) {
                if( parseInt(payType) == 4){
                    axios.post('/order/offlinePay',this.convertOrderData()).then(
                            function (res) {
                                if(res.data.success){
                                    window.open('/order/payCallBack/'+orderVM.contractcode,'_self');
                                }else{
                                    layui.use('layer',function () {
                                        layer.msg(res.data.message,{icon:2});
                                    })
                                    orderVM.btnShow=false;
                                }
                            }
                    )
                }
                else if(parseInt(payType) == 5){
                    //余额支付
                    axios.post('/order/balancePay',this.convertOrderData()).then(
                            function (res) {
                                if(res.data.success){
                                    window.open('/order/payCallBack/'+orderVM.contractcode,'_self')
                                }else{
                                    layui.use('layer',function () {
                                        layer.msg(res.data.message,{icon:2});
                                    })
                                    orderVM.btnShow=false;
                                }
                            }
                    )
                }
                else{
                    //网上银行 支付宝 微信
                    axios.post('/order/orderPay',this.convertOrderData()).then(
                            function (res) {
                                if(res && res.data.success){
                                    //提交订单成功 订单号
                                    if(parseInt(payType) == 1){
                                        orderVM.alipay = res.data.data;
                                        setTimeout(function () {
                                            $("#alipayForm").submit();
                                            payTips();
                                            orderVM.btnShow=false;
                                        },1000);
                                    }
                                    if(parseInt(payType) == 2){
                                        //微信支付弹出微信二位码
                                        $("#qrcode").empty();
                                        new QRCode($("#qrcode")[0], {
                                            text:res.data.data.code_url,
                                            width: 188,
                                            height: 188,
                                            colorDark : "#000000",
                                            colorLight : "#ffffff",
                                        });
                                        orderVM.weixinCallBack();
                                    }
                                    if(parseInt(payType) == 3){
                                        orderVM.hftxReq = res.data.data;
                                        setTimeout(function () {
                                            $("#payForm").submit();
                                            payTips();
                                            orderVM.btnShow=false;
                                        },1000)
                                    }
                                }
                            }
                    )
                }
            },
            //微信轮询接口
            weixinCallBack:function(){
                if(this.times<=0) return;
                this.times--;
                $.get('/order/payCallBackToJson/'+orderVM.contractcode).then(
                        function (res) {
                            if(res.data.data == "TRUE" && res.data.success){
                                $("#qrcode").html("已请求支付跳转....<a target='_blank' href='/order/payCallBack/"+orderVM.contractcode+"' >查看订单信息</a>");
                                this.times = 0;
                                window.open('/order/payCallBack/'+orderVM.contractcode,'_self')
                                payTips();
                            }else{
                                window.setTimeout(function () {
                                    orderVM.weixinCallBack();
                                },1000)
                            }
                        }
                )
            },
            //生成合同号接口
            convertProData:function () {
                orderVM.invoicData.billType = 3;
                delete orderVM.invoicData.id;
                if(orderVM.invoicData.taxpayerPath){
                    orderVM.invoicData.taxpayerPath = '/base'+orderVM.invoicData.taxpayerPath.split('/base')[1]
                }
                //orderVM.invoicData.taxpayerPath = orderVM.invoicData.taxpayerPath ? '/base'+orderVM.invoicData.taxpayerPath.split('/base')[1] : '';
                orderVM.invoicData.contractcode = orderVM.contractcode;
                var convertData = {
                    "openbill":orderVM.isBill,//是否开发票 0:不开发票  1:开发票
                    "contractcode":orderVM.contractcode,
                    "channel":"pc",
                    "shopLists":[],
                    "zgVatInfo":orderVM.invoicData,
                }
                //shoplist赋值
                pData.zgOrders.forEach(function(item){
                    convertData.shopLists.push(
                            {
                                "money":item.money,
                                "number": item.number||1,
                                "pcode": item.pcode,
                                "pname": item.pname,
                                "priceId": item.priceId,
                                "id":item.id,
                                "category":item.category,
                                "shopFeeChargeds":item.shopFeeChargeds,

                            }
                    )
                })
                //支付类型 1：线上 2：线下 3:账号
                if(this.payType == 4){
                    convertData.type = 21;
                }else if(this.payType ==5){
                    convertData.type = 15;
                } else if(this.payType ==3){
                    convertData.type = 11;
                } else if(this.payType ==2){
                    convertData.type = 33;
                } else if(this.payType ==1){
                    convertData.type = 12;
                }
                convertData.recipientId = orderVM.recipientId;
                this.convertCommonData(convertData);
                return convertData;
            },
            convertCommonData:function(convertData){
                /*if( parseInt(orderVM.isBill) == 1){
                    convertData.billType = orderVM.billType;//发票类型(0:普通发票 1专用发票)
                }*/
                //优惠券选择
                if(this.couponId!=-1){
                    var selectCoupon = $.grep(this.couponList,function (item) {
                        return orderVM.couponId == item.id
                    })[0];
                    convertData.couponId=selectCoupon.id;
                    convertData.cdkcode=selectCoupon.cdkcode;
                }
                //发票处理
                /*if(orderVM.isBill == 1){
                    if(orderVM.billType == 0){
                        //普通发票
                        convertData.billname = orderVM.billName;
                    }
                    if(orderVM.billType == 1){
                        //增值发票
                        //convertData.billname = orderVM.zgVatInfo.unitName;
                        convertData.zgVatInfo = orderVM.zgVatInfo;
                    }
                }*/
            },
            //转化订单支付数据 type 1:支付宝  2:微信 3:网银  4:转账
            convertOrderData:function (){
                var convertData={};
                this.convertCommonData(convertData);
                convertData.comcode = orderVM.contractcode;
                convertData.money = orderVM.count;//总金额
                convertData.channelSource = 'pc';//平台
                convertData.subject = pData.zgOrders[0].pname;//国内描述
                convertData.pcode = pData.zgOrders[0].pcode;//产品code
                convertData.body = pData.zgOrders[0].pname+"--来自北京知果果付款产品";//产品支付描述
                convertData.isBill = parseInt(orderVM.isBill);
                //convertData.billType = orderVM.billType ; //orderVM.billType发票类型TODO
                /*var convertData = {
                 comcode:orderVM.contractcode,
                 //orderId:orderVM.contractcode,
                 pcode:"cr_soft_1",
                 subject:"国内加急商标注册",
                 money:1,
                 body:"服务类别：国内加急商标注册",
                 isBill:orderVM.isBill,
                 billType:"0",
                 billName:"北京知果科技有限公司",
                 channelSource:"pc",
                 recipientId:12
                 }*/
                switch (parseInt(orderVM.payType)){
                    case 1:
                        convertData.payType = 12;
                        //TODO收款账户************分产品类型
                        if(orderVM.isPatent){
                            //专利走卓唐支付流程
                            convertData.receiptAccount = 81;
                        }else{
                            convertData.receiptAccount = 80;
                        }
                        break
                    case 2:
                        convertData.payType = 33;
                        convertData.receiptAccount = 80;
                        break
                    case 3:
                        convertData.payType = 11;
                        convertData.receiptAccount = 80;
                        convertData.bankCode = orderVM.bankCode
                        break
                    case 4:
                        if(orderVM.isPatent){
                            //专利走卓唐支付流程
                            convertData.receiptAccount = 81;
                        }else{
                            convertData.receiptAccount = 80;
                        }
                        convertData.trandCode = orderVM.trandCode //汇款流水号
                        break
                }
                return convertData;
            },
            validateForm:function(scope) {
                this.$validator.validateAll(scope).then(function(result) {
                    if (result) {
                        // eslint-disable-next-line
                        /* alert('Form Submitted!');*/
                        if(scope == 'form-1'){
                            orderVM.billTextName = orderVM.billName;
                        }
                        if(scope == 'form-2'){
                            orderVM.billTextName = orderVM.zgVatInfo.unitName;
                        }
                        orderVM.billTypeTemp =  orderVM.billType;
                        layer.close(addressOpen);
                        $("#BillBox").hide();
                    }
                });
            },
            //获取用户优惠卷
            getPcodeToCoupon:function () {
                orderVM.isShowCoupon = true;
            },
            //获取联动数据源
            getRegion:function () {
                axios.get('/region.json').then(
                        function (data) {
                            orderVM.province = data.data.data;
                        }
                )
            },
            /**
             * 查找地区联动
             * @param add 当前地址
             * @param type 1 市 2区县
             */
            tre_city:function (add,type) {
                var that = this;
                this.province.map(function (item) {
                    if(item.code == add.province){

                        if(type == 1){
                            that.$set(add,'cityList',item.sub);
                            that.$set(add,'provinceDesc',item.name);
                            that.tre_city(add,2)
                        }
                        if(type == 2){
                            that.$set(add,'countryList',[]);
                            item.sub.map(function(city){
                                if(city.code == add.city){
                                    that.$set(add,'countryList',city.sub);
                                    that.$set(add,'cityDesc',city.name);
                                    that.selected_show=true;
                                }
                            })
                            if(add.countryList.length == 0){
                                that.selected_show=false;
                            }
                        }
                    }
                });
            },

        }
    })
    var addressOpen;
    function bill_open() {
        orderVM.errors.clear('form-2');
        orderVM.errors.clear('form-1');
        orderVM.billType = orderVM.billTypeTemp;
        var layer_type = {
            type: 1,
            title: "发票信息",//false不显示标题栏,
            closeBtn: false,//是否显示头部删除按钮
            offset: '100px',
            area: '480px;',
            shade: 0.6,
            id: 'LAY_layuipro' ,//设定一个id，防止重复弹出,
            btn: ['取消', '保存'],
            moveType: 1 ,//拖拽模式，0或者1,
            content: $("#BillBox"),
            success: function (layero) {
                //弹框加载成功
            },
            yes:function () {
                layer.close(addressOpen);
                //发票信息取消默认选择第一项
                if(orderVM.billTextName == ""){
                    orderVM.isBill = 0;
                }
            },
            btn2:function () {
                if(orderVM.billType == 0){
                    orderVM.validateForm('form-1');
                }else{
                    orderVM.validateForm('form-2');
                }
                return false;
            }
        }
        layui.use('layer',function() {
            addressOpen = layer.open(layer_type);
        })
    }

    //显示支付跳转提示
    function payTips() {
        var layer_type = {
            type: 1,
            title: "支付提示",//false不显示标题栏,
            closeBtn: false,//是否显示头部删除按钮
            offset: '100px',
            area: '480px;',
            shade: 0.6,
            id: 'LAY_payTips' ,//设定一个id，防止重复弹出,
            btn: ['支付成功', '继续购物'],
            moveType: 1 ,//拖拽模式，0或者1,
            content: "<div class='paytips'><h1>请您在新打开的页面完成支付</h1><p>付款完成前请不要关闭此窗口<a href='/help/index' target='_blank'>遇到问题?</a></p></div>",
            success: function (layero) {
                //弹框加载成功
            },
            yes:function () {
                //点击支付成功
                window.location.href="/userOrder";
            },
            btn2:function () {
                window.location.href="/";
            }
        }
        layui.use('layer',function() {
            payTipsOpen = layer.open(layer_type);
        })
    }

</script>